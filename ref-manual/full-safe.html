<!doctype html>
<html lang="en" ng-app="radianDocs">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Radian - Reference manual</title>
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
  <link rel="stylesheet" href="../css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="../css/radian.css" type="text/css" />
</head>
<body ng-controller="DummyCtrl">
  <div class="container">
    <div class="navbar">
      <div class="navbar-inner">
        <a class="brand" href="../index.html">Radian</a>
        <ul class="nav">
          <li><a href="../index.html">Home</a></li>
          <li><a href="../documentation.html">Documentation</a></li>
          <li><a href="../download.html">Download</a></li>
          <li><a href="../community.html">Community</a></li>
          <li><a href="../gallery">Gallery</a></li>
          <li><a href="../license.html">License</a></li>
          <li><a href="../faq.html">FAQ</a></li>
        </ul>
      </div>
    </div>

    <p><strong>Note that throughout this page, in running text Radian expressions are represented as <code>[ [expr]]</code>. That space between the leading square brackets shouldn’t be there, but it’s needed to stop GitHub’s Markdown parser from interpreting Radian expressions as links (even within code backticks…).</strong></p>
<h3 id="february-2013">12 February 2013</h3>
<h2 id="introduction">Introduction</h2>
<p>The <em>Radian</em> plotting library provides a convenient approach to embedding SVG plots in HTML documents. Plots are specified using custom HTML-like elements (e.g. <code>&lt;plot&gt;</code>, <code>&lt;lines&gt;</code>, <code>&lt;plot-data&gt;</code>, etc.) whose attributes and contents are used to control plot appearance and plot data. A flexible expression syntax is provided to make the access of compound JSON datasets simple, and to allow for grouping and simple processing of data for plotting.</p>
<p><em>Radian</em> works by combining the benefits of the AngularJS JavaScript framework with the data visualisation capabilities of the D3.js library. A Haskell combinator library is provided for easy server-side rendering of plots.</p>
<h4 id="caveat">Caveat</h4>
<p>Because of the way that browsers parse HTML pages, it is, in general, not possible to use XML’s compact tag syntax <code>&lt;tag a=&quot;abc&quot;/&gt;</code> for custom tags that are not part of the HTML standard even if these tags do not have any content. This means that all custom tags must be closed by an explicit close tag, even if there is no content within the tag. For example, <code>&lt;metadata&gt;</code> tags must always be immediately closed by a <code>&lt;/metadata&gt;</code>.</p>
<h2 id="javascript-data-access">JavaScript data access</h2>
<p>The HTML side of the plotting API uses a slight extension of the JavaScript expression syntax to express values to be plotted. Data sets can be included in HTML pages and named using the <code>&lt;plot-data&gt;</code> directive, and AngularJS data binding can be used to access arbitrary values from page UI elements or other sources.</p>
<h3 id="the-plot-data-directive">The <code>&lt;plot-data&gt;</code> directive</h3>
<p><strong>Not done: load from URL</strong></p>
<h6 id="attributes">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>NAME</code></td>
<td align="left">Data set name (mandatory)</td>
</tr>
<tr class="even">
<td align="left"><code>FORMAT</code></td>
<td align="left">One of <code>csv</code> or <code>json</code> (default)</td>
</tr>
<tr class="odd">
<td align="left"><code>COLS</code></td>
<td align="left">Column names for CSV data</td>
</tr>
<tr class="even">
<td align="left"><code>SEPARATOR</code></td>
<td align="left">Separator character for columns in CSV data (defaults to “,”)</td>
</tr>
<tr class="odd">
<td align="left"><code>SRC</code></td>
<td align="left">URL for data source</td>
</tr>
</tbody>
</table>
<h6 id="body">Body</h6>
<p>Optionally, <code>metadata</code> directives describing the data values. If no <code>SRC</code> attribute is used to specify the data source, then the data values are included in the body of the directive in the given format.</p>
<h6 id="interpretation">Interpretation</h6>
<p>The <code>&lt;plot-data&gt;</code> directive forms an association between the name given as the <code>ID</code> attribute of the directive and the given data set. The data set name can then be used to create data paths to access components of the data set in plotting directives (<a href="#data-accessors">see here</a>).</p>
<p>When data is loaded from a URL, the semantics of the <code>&lt;plot-data&gt;</code> directive are identical to the case where the data is included directly in the directive body (except for possible rendering issues if the data download takes a long time…).</p>
<h6 id="examples">Examples</h6>
<p>Temperature data by date with error information: <code>html &lt;plot-data id=&quot;globaltemp&quot; format=&quot;csv&quot; cols=&quot;date,temp,error&quot;&gt;   &lt;metadata name=&quot;date&quot; format=&quot;date&quot;/&gt;   &lt;metadata name=&quot;temp&quot; label=&quot;Global mean temperature&quot; units=&quot;&amp;deg;C&quot;/&gt;   &lt;metadata name=&quot;error&quot; error-for=&quot;temp&quot;/&gt; &quot;1970-01-15&quot;, 17.352, 0.100 &quot;1970-02-14&quot;, 16.936, 0.090 &quot;1970-03-15&quot;, 17.029, 0.095 &quot;1970-04-15&quot;, 17.550, 0.087 ... &lt;/plot-data&gt;</code></p>
<p>JSON location data: <code>html &lt;plot-data id=&quot;pumps&quot;&gt;   [ { &quot;name&quot;: &quot;Broad Street&quot;, &quot;lat&quot;: 51.02345, &quot;lon&quot;: 0.02345 },     { &quot;name&quot;: &quot;Other&quot;,        &quot;lat&quot;: 51.05445, &quot;lon&quot;: 0.04538 } ] &lt;/plot-data&gt;</code></p>
<h3 id="the-metadata-directive">The <code>&lt;metadata&gt;</code> directive</h3>
<p>The <code>&lt;metadata&gt;</code> directive that may appear inside <code>&lt;plot-data&gt;</code> directives provides additional information about <code>&lt;plot-data&gt;</code> data fields that may be useful for plotting. Multiple <code>&lt;metadata&gt;</code> items may appear within a <code>&lt;plot-data&gt;</code> directive, up to one per data field.</p>
<h6 id="attributes-1">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>NAME</code></td>
<td align="left">Refers to a data field name in the enclosing<code>&lt;plot-data&gt;</code> directive (mandatory)</td>
</tr>
<tr class="even">
<td align="left"><code>FORMAT</code></td>
<td align="left">Absent or <code>date</code> (specifies dates either using flexible parsing or in restricted format given by the <code>DATE-PARSE-FORMAT</code> attribute)</td>
</tr>
<tr class="odd">
<td align="left"><code>DATE-PARSE-FORMAT</code></td>
<td align="left"><code>strftime()</code>-like date parsing format (or <code>isodate</code> to specify dates in strict ISO 8601 format)</td>
</tr>
<tr class="even">
<td align="left"><code>DATE-FORMAT</code></td>
<td align="left">Date output format for plot axes</td>
</tr>
<tr class="odd">
<td align="left"><code>LABEL</code></td>
<td align="left">Axis/legend label for the named data field</td>
</tr>
<tr class="even">
<td align="left"><code>UNITS</code></td>
<td align="left">Units for the named field</td>
</tr>
<tr class="odd">
<td align="left"><code>ERROR-FOR</code></td>
<td align="left">Names another data field for which this field is an uncertainty/error value</td>
</tr>
</tbody>
</table>
<h6 id="body-1">Body</h6>
<p>None</p>
<h6 id="interpretation-1">Interpretation</h6>
<p>A <code>&lt;metadata&gt;</code> directive specifies metadata for a single field of an associated containing <code>&lt;plot-data&gt;</code> directive. This metadata either gives label and units information for axis and legend labels, marks data fields as having special formats (currently only dates, but this could be used for other things as well) and allows fields to be marked up as providing uncertainty values for other fields (this information can be used to plot error bars or uncertainty ranges).</p>
<p>The data field that the metadata corresponds to is specified using the <code>NAME</code> attribute, which is a period-separated list of field names giving a path to the field of interest.</p>
<h6 id="examples-1">Examples</h6>
<p>Simple example demonstrating all attributes: <code>html &lt;metadata name=&quot;date&quot; format=&quot;date&quot; date-parse-format=&quot;isodate&quot;           date-format=&quot;%e %b %Y&quot;&gt;&lt;/metadata&gt; &lt;metadata name=&quot;date.doy&quot; label=&quot;Day of year&quot;&gt;&lt;/metadata&gt; &lt;metadata name=&quot;temp&quot; label=&quot;Mean temperature&quot; units=&quot;&amp;deg;C&quot;&gt;&lt;/metadata&gt; &lt;metadata name=&quot;error&quot; error-for=&quot;temp&quot;&gt;&lt;/metadata&gt;</code></p>
<h3 id="data-accessor-syntax"><a name="data-accessors">Data accessor syntax</a></h3>
<p>Within plotting directives, data values to be plotted, as well as other plot attributes (e.g. marker size, colours, and so on) are specified using an extended JavaScript expression syntax. There are three aspects to this syntax: permitted operators, name scoping and attribute data binding, and standard functions.</p>
<p>In order to distinguish between Radian expressions and raw string values, all Radian expressions are enclosed in double square brackets, e.g. <code>[ [x+y]]</code>. This is the same sort of approach as taken in Angular, where the double brace notation <code>{{expr}}</code> introduces an Angular expression. The Radian expression syntax is a superset of full JavaScript expression syntax, so is rather more flexible than the more restricted grammar supported for Angular expressions.</p>
<h4 id="data-accessor-operators">Data accessor operators</h4>
<p>Data accessor syntax allows three extensions to standard JavaScript syntax. These are intended to make it more convenient to write the kinds of expressions that needed in common plot types.</p>
<p><strong>Exponentiation operator</strong> Instead of writing <code>Math.pow(x,y)</code>, one may write <code>x**y</code>. The <code>**</code> operator has a higher precedence than any other binary operator.</p>
<p><strong>Pluck operator</strong> If <code>y</code> is an identifier, the expression <code>x#y</code> is equivalent to <code>javascript x.map(function(e) { return e.y; )}</code> while if <code>y</code> is an integer literal, <code>x#y</code> is equivalent to <code>javascript x.map(function(e) { return e[y]; )}</code> and if <code>expr</code> is a general JavaScript expression, <code>x#(expr)</code> (note parentheses!) is equivalent to <code>javascript x.map(function(e) { return e[expr]; )}</code></p>
<p>This allows fields from arrays of objects or arrays of arrays to be plucked out into flat arrays in a simple way (method “plucking” of the form <code>x#f(z)</code> is also supported). This syntax is particularly useful for JSON arrays of objects or for compound object fields within other data. For instance, if we have a data set <code>d</code> with a field <code>date</code> containing an array of date fields, we can extract the day of year of each date as a single array using the expression <code>d.date#dayOfYear()</code>. Note that the <em>only</em> possibilities for the right hand side of the <code>#</code> operator are an identifier, a literal integer or a parenthesised expression (the parentheses are necessary for disambiguation of the <code>x#y</code> and <code>x#(y)</code> cases – in the first case <code>y</code> is an identifier, in the second an expression).</p>
<p><strong>Expression vectorisation</strong> Standard functions and arithmentic operators are automatically vectorised, so that, for example, <code>sin(x)</code> calculates either the sine of a single value or an array and <code>x + y</code> adds two arrays, two scalars or a scalar and an array in the natural way. This means that we can express functional plots in a very simple way: <code>html &lt;plot height=300 aspect=3 stroke-width=1&gt;   &lt;lines x=&quot;[[seq(-1,1,100)]]&quot; y=&quot;[[-x**3+x+sin(x)]]&quot; stroke=&quot;red&quot;/&gt; &lt;/plot&gt;</code></p>
<h4 id="name-scoping-and-data-binding-in-data-accessors">Name scoping and data binding in data accessors</h4>
<p>The following names are in scope within data accessor expressions:</p>
<ul>
<li><p>The names of all datasets defined in <code>&lt;plot-data&gt;</code> directives, with variable names given by the directives’ <code>ID</code> attributes.</p></li>
<li><p>All names passed as attributes to plotting directives that are not reserved (see list in the <a href="#reserved">Appendix</a>).</p></li>
<li><p>The functions and constants defined <a href="#std-fns">here</a>.</p></li>
</ul>
<p>What this means is that it is possible to pass data values around using attributes with meaningful names. Keeping the namespace for plot expression evaluation separate from the Angular scope namespaces is useful since we want to implicitly bring data set names into scope, as well as simplified standard function names to make writing plot directives quick and simple.</p>
Combined with Angular’s <code>ng-model</code> data binding attribute and <code>{{expr}}</code> expression syntax, we can do some very powerful things: ```html
<div class="form-inline">
  
<label>Mean</label> <input type="text" ng-model="mu" ng-init="mu=5"> <label>  Standard deviation</label> <input type="text" ng-model="sigma" ng-init="sigma=1">
</div>
<p><br></p>
<p><plot height="300" aspect="3" stroke-width="2" stroke="red"> <lines x="[[seq(0,10,200)]]" y="[[normal(x,{{mu}},{{sigma}})]]"></lines> </plot> ```</p>
<p>In this example, updating the values in the input text fields triggers an immediate update of the plot, pulling in the new values from the UI elements. This means that plots can be attached to arbitrary UI elements with ease. Note how Angular expressions with their <code>{{expr}}</code> syntax may be embedded within Radian expressions. The Radian expression parsing infrastructure interacts correctly with Angular data binding so that plots are regenerated when Angular expressions within Radian expressions change.</p>
<h4 id="standard-functions"><a name="std-fns">Standard functions</a></h4>
<h6 id="javascript-standard-functions">JavaScript standard functions</h6>
<p>The following constants and functions from the <code>Math.xxx</code> JavaScript scope are brought into scope within data accessor expressions (i.e. one can write “<code>sin(x)</code>” instead of “<code>Math.sin(x)</code>”): <code>E</code>, <code>LN10</code>, <code>LN2</code>, <code>LOG10E</code>, <code>LOG2E</code>, <code>PI</code>, <code>SQRT1\_2</code>, <code>SQRT2</code>, <code>abs</code>, <code>acos</code>, <code>asin</code>, <code>atan</code>, <code>atan2</code>, <code>ceil</code>, <code>cos</code>, <code>exp</code>, <code>floor</code>, <code>log</code>, <code>pow</code>, <code>round</code>, <code>sin</code>, <code>sqrt</code>, <code>tan</code>.</p>
<h6 id="d3-functions">D3 functions</h6>
<p>The following functions from the <code>d3.xxx</code> JavaScript scope are brought into scope within data accessor expressions (i.e. one can write “<code>extent(x)</code>” instead of “<code>d3.extent(x)</code>”): <code>min</code>, <code>max</code>, <code>extent</code>, <code>sum</code>, <code>mean</code>, <code>median</code>, <code>quantile</code>, <code>zip</code>.</p>
<h6 id="extra-functions">Extra functions</h6>
<p><code>seq</code>, <code>seqStep</code>: Generate evenly spaced sequences of values: <code>seq(start, end, n)</code> produces a sequence of <code>n</code> values ranging from <code>start</code> to <code>end</code>, while <code>seqStep(start, end, delta)</code> produces a sequence from <code>start</code> to <code>end</code> in steps of <code>delta</code>.</p>
<p><code>sdev</code>: Calculate the sample standard deviation of an array.</p>
<p><code>unique</code>: Return the unique entries in an array in the order that they first appear.</p>
<p><code>minBy</code>, <code>maxBy</code>, <code>sumBy</code>, <code>meanBy</code>, <code>sdevBy</code>: Calculate categorical sums, means and standard deviations of data sets: <code>sumBy(x, y)</code> calculates the sum of <code>x</code> values for each distinct value of <code>y</code>, returning an array of results in the order of occurrence of the distinct values in <code>y</code>. For example, given a dataset <code>d</code> containing daily temperature data with associated dates, <code>meanBy(d#temp, d#date#mon)</code> calculates a monthy seasonal cycle of temperatures.</p>
<p><code>normal</code>: Normal distribution function: <code>normal(x, mu, sigma)</code> gives the value of the normal PDF with mean <code>mu</code> and standard deviation <code>sigma</code> at ordinate <code>x</code>.</p>
<p><code>lognormal</code>: Log-normal distribution function: <code>lognormal(x, mu, sigma)</code> gives the value of the log-normal PDF with mean <code>mu</code> and standard deviation <code>sigma</code> at ordinate <code>x</code>.</p>
<p><code>gamma</code>: Gamma distribution function: <code>gamma(x, k, theta)</code> gives the value of the gamma PDF with shape parameter <code>k</code> and scale parameter <code>theta</code> at ordinate <code>x</code>.</p>
<p><code>invgamma</code>: Inverse gamma distribution function: <code>invgamma(x, alpha, beta)</code> gives the value of the inverse gamma PDF with shape parameter <code>alpha</code> and scale parameter <code>beta</code> at ordinate <code>x</code>.</p>
<h4 id="handling-of-dates">Handling of dates</h4>
<p>Time and date data can be read using a <code>&lt;metadata&gt;</code> directive with a <code>FORMAT=&quot;date&quot;</code> attribute. Individual fields of date values can then be plucked from date data using methods of the standard JavaScript <code>Date</code> class: for instance, <code>date#getMonth()</code> extracts the month field from a series of dates. In combination with aggregation functions and arbitrary mapping functions, this allows for various complex manipulations of date data. This example shows extraction of date fields, aggregation (using the <code>unique</code> and <code>meanBy</code> functions) and the use of a user-defined function (<code>midMonths</code>) injected into the <code>plotLib</code> plotting library in the Angular controller used to manage the page: <code>html &lt;plot height=300 aspect=3 stroke-width=2&gt;   &lt;lines x=&quot;vic2012ooa.date&quot; y=&quot;vic2012ooa.tmp&quot; stroke=&quot;red&quot;/&gt;   &lt;lines x=&quot;[[midMonths(unique(vic2012ooa.date#getMonth()), 2012)]]&quot;          y=&quot;[[meanBy(vic2012ooa.prc,vic2012ooa.date#getMonth())]]&quot;          stroke=&quot;blue&quot;/&gt; &lt;/plot&gt;</code></p>
<h4 id="examples-2">Examples</h4>
<p>In this simple example, we use Angular data binding to set the <code>mu</code> and <code>sigma</code> attributes from scope variables called <code>mean</code> and <code>sdev</code>. These “attribute variables” are then in scope for the calculation of <code>x</code> and <code>y</code> attributes for the plot: <code>html &lt;lines mu=&quot;{{mean}}&quot; sigma=&quot;{{sdev}}&quot;        x=&quot;[[seq(mu-3*sigma,mu+3*sigma,100)]]&quot; y=&quot;[[normal(x,mu,sigma)]]&quot;/&gt;</code></p>
<p>The processing of this example goes as follows:</p>
<table>
<thead>
<tr class="header">
<th align="left">Evaluate</th>
<th align="left">Requires</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>x</code></td>
<td align="left"><code>mu</code>, <code>sigma</code></td>
</tr>
<tr class="even">
<td align="left"><code>y</code></td>
<td align="left"><code>x</code>, <code>mu</code>, <code>sigma</code></td>
</tr>
<tr class="odd">
<td align="left"><code>mu</code></td>
<td align="left">AngularJS fills in value from scope</td>
</tr>
<tr class="even">
<td align="left"><code>sigma</code></td>
<td align="left">AngularJS fills in value from scope</td>
</tr>
</tbody>
</table>
<h2 id="plot-types">Plot types</h2>
<h3 id="the-plot-directive">The <code>&lt;plot&gt;</code> directive</h3>
<p><strong>Not done: y-zooming, 2D pan and zoom, proper legend management, marker size and type, fill opacity.</strong></p>
<h6 id="attributes-2">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>RANGE-X</code></td>
<td align="left">Specify <span class="math"><em>x</em></span>-coordinate range for plot</td>
</tr>
<tr class="even">
<td align="left"><code>RANGE-Y</code></td>
<td align="left">Specify <span class="math"><em>y</em></span>-coordinate range for plot</td>
</tr>
<tr class="odd">
<td align="left"><code>RANGE</code></td>
<td align="left">Specify both <span class="math"><em>x</em></span>- and <span class="math"><em>y</em></span>-coordinate ranges for plot together</td>
</tr>
<tr class="even">
<td align="left"><code>AXIS-X</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow (default) or suppress axis display, or a tick specification</td>
</tr>
<tr class="odd">
<td align="left"><code>AXIS-X-TRANSFORM</code></td>
<td align="left">If present, one of <code>linear</code> (default) or <code>log</code></td>
</tr>
<tr class="even">
<td align="left"><code>AXIS-X2</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow or suppress (default) axis display, or a tick specification</td>
</tr>
<tr class="odd">
<td align="left"><code>AXIS-Y</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow (default) or suppress axis display, or a tick specification</td>
</tr>
<tr class="even">
<td align="left"><code>AXIS-Y-TRANSFORM</code></td>
<td align="left">If present, one of <code>linear</code> (default) or <code>log</code></td>
</tr>
<tr class="odd">
<td align="left"><code>AXIS-Y2</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow or suppress (default) axis display, or a tick specification</td>
</tr>
<tr class="even">
<td align="left"><code>AXIS-X-LABEL</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow (default) or suppress axis labelling, or a label string (when <code>on</code> is used, the axis label is taken from metadata where possible)</td>
</tr>
<tr class="odd">
<td align="left"><code>AXIS-X2-LABEL</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow or suppress (default) axis labelling, or a label string (when <code>on</code> is used, the axis label is taken from metadata where possible)</td>
</tr>
<tr class="even">
<td align="left"><code>AXIS-Y-LABEL</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow (default) or suppress axis labelling, or a label string (when <code>on</code> is used, the axis label is taken from metadata where possible)</td>
</tr>
<tr class="odd">
<td align="left"><code>AXIS-Y2-LABEL</code></td>
<td align="left">Either <code>on</code>/<code>off</code> to allow or suppress (default) axis labelling, or a label string (when <code>on</code> is used, the axis label is taken from metadata where possible)</td>
</tr>
<tr class="even">
<td align="left"><code>X</code></td>
<td align="left">Data path defining x-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>Y</code></td>
<td align="left">Data path defining y-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>X2</code></td>
<td align="left">Data path defining x2-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>Y2</code></td>
<td align="left">Data path defining y2-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>TITLE</code></td>
<td align="left">Plot title</td>
</tr>
<tr class="odd">
<td align="left"><code>WIDTH</code></td>
<td align="left">Plot width in pixels</td>
</tr>
<tr class="even">
<td align="left"><code>HEIGHT</code></td>
<td align="left">Plot height in pixels</td>
</tr>
<tr class="odd">
<td align="left"><code>ASPECT</code></td>
<td align="left">Plot aspect ratio</td>
</tr>
<tr class="even">
<td align="left"><code>ZOOM-X</code></td>
<td align="left">Presence/absence or fraction: enable X-zooming</td>
</tr>
<tr class="odd">
<td align="left"><code>ZOOM-Y</code></td>
<td align="left">Presence/absence or fraction: enable X-zooming</td>
</tr>
<tr class="even">
<td align="left"><code>ZOOM-2D</code></td>
<td align="left">Presence/absence: enable 2-D pan and zoom</td>
</tr>
<tr class="odd">
<td align="left"><code>LEGEND-SWITCHES</code></td>
<td align="left">Enable interactive on/off switching of traces via the plot legend</td>
</tr>
<tr class="even">
<td align="left"><code>STROKE-SWITCH</code></td>
<td align="left">Labels for stroke switching UI</td>
</tr>
<tr class="odd">
<td align="left"><code>SELECT-X</code></td>
<td align="left">Provide UI for selecting between x-variables of plot</td>
</tr>
<tr class="even">
<td align="left"><code>SELECT-Y</code></td>
<td align="left">Provide UI for selecting between y-variables of plot</td>
</tr>
<tr class="odd">
<td align="left"><code>MARKER</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>MARKER-SIZE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>FILL</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>FILL-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>STROKE-WIDTH</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
</tbody>
</table>
<ul>
<li><p>The coordinate ranges for the plot are controlled by the <code>RANGE-X</code>, <code>RANGE-Y</code> and <code>RANGE</code> attributes. These can be specified either explicitly (e.g. <code>range-x=&quot;0,20&quot;</code> or <code>range=&quot;0,20;0,50&quot;</code>), via a data path (in which case the range is taken from the extent of the data values, excluding infinite and NaN values) or via a URL (in which case the range is taken from the coordinate range of the SVG image the URL points to).</p></li>
<li><p>The actual plot dimensions are determined from a combination of the <code>WIDTH</code>, <code>HEIGHT</code> and <code>ASPECT</code> attributes and CSS dimension styles for the <code>bh-plot</code> CSS class.</p></li>
<li><p>Only one of <code>ZOOM-X</code>, <code>ZOOM-Y</code> or <code>ZOOM-2D</code> may be specified on a plot. The <code>ZOOM-X</code> and <code>ZOOM-Y</code> attributes can specify a fraction of the plot viewport to be used for the zoom component.</p></li>
<li><p>The <code>STROKE-SWITCH</code> attribute gives a semicolon separated list of labels used to refer to the possible stroke values in subsidiary plots. If a single string is given (i.e. no semicolons), a simple switch between “on” and “off” is provided as a UI element and selection is performed between the first and second stroke possibilities for each subsidiary plot. If more than one label is provided, a selection UI is used, and as many stroke possibilities can be selected as labels are given.</p></li>
<li><p>The <code>SELECT-X</code> and <code>SELECT-Y</code> UI elements interact in such a way as to provide a reasonable interface for managing the variables shown in an x-vs.-y plot: it is never possible to select the same variable for the x and y variable, and switching between plot variables is handled sensibly.</p></li>
</ul>
<h6 id="body-2">Body</h6>
<p>The body of a <code>&lt;plot&gt;</code> directive should contain directives specifying the data to be drawn into the plot (using <code>&lt;lines&gt;</code>, <code>&lt;points&gt;</code>, etc.). There may also be a <code>&lt;plot-options&gt;</code> directive specifying paint and calculational attributes common to all plot directives.</p>
<h3 id="option-defaulting-and-the-plot-options-directive">Option defaulting and the <code>&lt;plot-options&gt;</code> directive</h3>
<p>The <code>&lt;plot-options&gt;</code> directive can be used to wrap inner plotting directives that share plotting options. For instance, the following example plots two line graphs that share a stroke width value. Note how attribute variables defined in the main <code>&lt;plot&gt;</code> directive propagate down to the inner plotting directives, and also how attributes set in <code>&lt;plot-options&gt;</code> can be overridden by the inner plotting directives: <code>html &lt;plot height=300 aspect=3 xs=&quot;[[seq(-1,1,100)]]&quot;&gt;   &lt;plot-options stroke-width=2 stroke=&quot;red&quot;&gt;     &lt;lines x=&quot;[[xs]]&quot; y=&quot;[[-x**3+x+1]]&quot;/&gt;     &lt;lines x=&quot;[[xs]]&quot; y=&quot;[[x**2]]&quot; stroke=&quot;blue&quot;/&gt;   &lt;/plot-options&gt; &lt;/plot&gt;</code></p>
<h3 id="paint-attributes">Paint attributes</h3>
<p><strong>Need to separate this out and document the interpolation choices for these clearly.</strong></p>
<h3 id="line-plots-and-the-lines-directive">Line plots and the <code>&lt;lines&gt;</code> directive</h3>
<h6 id="attributes-3">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>X</code></td>
<td align="left">Data path defining x-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y</code></td>
<td align="left">Data path defining y-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>X2</code></td>
<td align="left">Data path defining x2-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y2</code></td>
<td align="left">Data path defining y2-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>STROKE-WIDTH</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>LABEL</code></td>
<td align="left">Label for line in plot legend</td>
</tr>
</tbody>
</table>
<h6 id="body-3">Body</h6>
<p>None</p>
<h6 id="interpretation-2">Interpretation</h6>
<p>Produces a line plot from the given x and y coordinate data.</p>
<h6 id="examples-3">Examples</h6>
<p>Simple plot with two line graphs – note the inheritance of the <code>STROKE-WIDTH</code> standard paint attribute from the containing <code>&lt;plot&gt;</code> directive: <code>html &lt;plot height=300 aspect=3 stroke-width=2&gt;   &lt;lines x=&quot;[[vic2012ooa.day]]&quot; y=&quot;[[vic2012ooa.tmp]]&quot; stroke=&quot;red&quot;/&gt;   &lt;lines x=&quot;[[vic2012ooa.day]]&quot; y=&quot;[[vic2012ooa.prc]]&quot; stroke=&quot;blue&quot;/&gt; &lt;/plot&gt;</code></p>
<h3 id="area-plots-and-the-area-directive">Area plots and the <code>&lt;area&gt;</code> directive</h3>
<h6 id="attributes-4">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>X</code></td>
<td align="left">Data path defining x-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y</code></td>
<td align="left">Data path defining upper y-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>YMIN</code></td>
<td align="left">Data path or constant value defining lower y-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>X2</code></td>
<td align="left">Data path defining x2-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>Y2</code></td>
<td align="left">Data path defining upper y2-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y2MIN</code></td>
<td align="left">Data path or constant value defining lower y-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>FILL</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>FILL-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>LABEL</code></td>
<td align="left">Label for area plot in plot legend</td>
</tr>
</tbody>
</table>
<h6 id="body-4">Body</h6>
<p>None</p>
<h6 id="interpretation-3">Interpretation</h6>
<p>Produces an area line plot from the given x and y coordinate data. It is possible to specify both upper (<code>Y</code> or <code>Y2</code>) and lower (<code>YMIN</code> or <code>Y2MIN</code>) bounds for the area display, either as a data path or as a constant value (default 0).</p>
<h6 id="examples-4">Examples</h6>
<p>Area plot used to show monthly precipitation range along with line graph of monthly means and temperature data: <code>html &lt;plot height=300 aspect=3 stroke-width=2 range-y2=&quot;-10&quot;       axis-y-label=&quot;Precipitation (mm/month)&quot;       mmonths=&quot;[[midMonths(unique(vic2012ooa.date#getMonth()),2012)]]&quot;       mprecip=&quot;[[sumBy(vic2012ooa.prc,vic2012ooa.date#getMonth())]]&quot;       msd=&quot;[[sdevBy(vic2012ooa.prc,vic2012ooa.date#getMonth())]]&quot;&gt;   &lt;area x=&quot;[[mmonths]]&quot; y2min=&quot;[[mprecip-msd]]&quot; y2=&quot;[[mprecip+msd]]&quot;         fill=&quot;lightblue&quot;/&gt;   &lt;lines x=&quot;[[mmonths]]&quot; y2=&quot;[[mprecip]]&quot; stroke=&quot;blue&quot;/&gt;   &lt;lines x=&quot;[[vic2012ooa.date]]&quot; y=&quot;[[vic2012ooa.tmp]]&quot; stroke=&quot;red&quot;/&gt; &lt;/plot&gt;</code></p>
<h3 id="marker-plots-and-the-points-directive">Marker plots and the <code>&lt;points&gt;</code> directive</h3>
<p><strong>Not done: marker orientation</strong></p>
<h6 id="attributes-5">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>X</code></td>
<td align="left">Data path defining x-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y</code></td>
<td align="left">Data path defining y-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>MARKER</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>MARKER-SIZE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>STROKE-WIDTH</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>FILL</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>FILL-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>ORIENTATION</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>LABEL</code></td>
<td align="left">Label for points in plot legend</td>
</tr>
</tbody>
</table>
<h6 id="body-5">Body</h6>
<p>None</p>
<h6 id="interpretation-4">Interpretation</h6>
<p>Produces a scatter/bubble plot from the given x and y coordinate data. Points are placed at the positions given by the <code>X</code> and <code>Y</code> attributes, using markers of the type specified by the <code>MARKER</code> attribute oriented according to the <code>ORIENTATION</code> attribute, coloured according to the <code>STROKE</code> and <code>FILL</code> attributes (which are not necessarily appropriate for all marker types) and sized according to the <code>MARKER-SIZE</code> attribute (which is a linear size whose exact interpretation depends on the marker used). All of the paint attributes can either be fixed or be functions of arbitrary variables that are in scope in Radian expressions defining the attributes.</p>
<h6 id="examples-5">Examples</h6>
<p>Simple scatter plot with fixed styling: <code>html &lt;plot height=300 marker-size=1.5 marker=&quot;circle&quot; stroke=&quot;none&quot;&gt;   &lt;points x=&quot;[[ctrl.pred1]]&quot; y=&quot;[[ctrl.resp]]&quot; fill=&quot;black&quot;&gt;&lt;/points&gt;   &lt;points x=&quot;[[treat.pred1]]&quot; y=&quot;[[treat.resp]]&quot; fill=&quot;red&quot;&gt;&lt;/points&gt; &lt;/plot&gt;</code></p>
<p>More complex plot with calculation of attributes from data – note the inheritance of the <code>STROKE</code> and <code>STROKE-WIDTH</code> standard paint attributes from the containing <code>&lt;plot&gt;</code> directive, the extraction of timeslices of data for the x- and y-coordinate values, the allocation of fill colours from a standard palette based on a categorical variable in the country data, and the generation of markers whose areas are linearly related to country population for the current year, normalised by the population across the whole dataset (this example uses an additional custom <code>fillIn</code> function for data pre-processing): <code>html &lt;plot height=500 stroke=&quot;black&quot; stroke-width=1       gdp=&quot;[[nat#income.map(function(d){return fillIn(d,1800,2009);}))]]&quot;       life=&quot;[[nat#lifeExpectancy.map(function(d){return fillIn(d,1800,2009);}))]]&quot;       pop=&quot;[[nat#population.map(function(d){return fillIn(d,1800,2009);}))]]&quot;       region=&quot;[[nat#region]]&quot; yidx=&quot;[[year-1800]]&quot;       range-x=&quot;300,100000&quot; range-y=&quot;10,90&quot;       popint=&quot;[[interpolate(pop,[1,1000],'sqrt')]]&quot;       axis-x-label=&quot;Per capita GDP&quot; axis-x-transform=&quot;log&quot;       axis-y-label=&quot;Life expectancy&quot;&gt;   &lt;points x=&quot;[[gdp.map(function(d) { return d[yidx]; })]]&quot;           y=&quot;[[life.map(function(d) { return d[yidx]; })]]&quot;           fill=&quot;[[category10(region)]]&quot;           marker-size=&quot;[[popint(pop.map(function(d) { return d[yidx]; }))]])&quot;&gt;   &lt;/points&gt; &lt;/plot&gt;</code></p>
<h3 id="bar-charts-and-the-bars-directive">Bar charts and the <code>&lt;bars&gt;</code> directive</h3>
<h6 id="attributes-6">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>X</code></td>
<td align="left">Data path defining x-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y</code></td>
<td align="left">Data path defining y-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>X2</code></td>
<td align="left">Data path defining x2-coordinate for plot data</td>
</tr>
<tr class="even">
<td align="left"><code>Y2</code></td>
<td align="left">Data path defining y2-coordinate for plot data</td>
</tr>
<tr class="odd">
<td align="left"><code>BAR-WIDTH</code></td>
<td align="left">Width for bars (single pixel value or fractions)</td>
</tr>
<tr class="even">
<td align="left"><code>BAR-OFFSET</code></td>
<td align="left">Offsets for bars (single pixel value or fractions)</td>
</tr>
<tr class="odd">
<td align="left"><code>FILL</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>FILL-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>STROKE-WIDTH</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="odd">
<td align="left"><code>STROKE-OPACITY</code></td>
<td align="left">Standard paint attribute</td>
</tr>
<tr class="even">
<td align="left"><code>LABEL</code></td>
<td align="left">Label for bars in plot legend</td>
</tr>
</tbody>
</table>
<h6 id="body-6">Body</h6>
<p>None</p>
<h6 id="interpretation-5">Interpretation</h6>
<p>Produces a bar chart from the given x and y coordinate data. The x-coordinates give the bar centres and the y coordinates the bar heights.</p>
<h6 id="examples-6">Examples</h6>
<p>Simple bar chart with fixed bar widths: ```html <plot height="300" aspect="3" stroke-width="2" range-y="0" stroke="blue" fill="skyblue"> <bars x="[[test.x]]" y="[[test.y]]" bar-width="50px"></bars> </plot></p>
<p><plot-data name="test" format="csv" cols="x,y"> 1, 2 2, 4 3, 8 4, 16 5, 32 6, 48 7, 24 8, 12 9, 6 10, 3 </plot-data> ```</p>
<h3 id="the-background-directive">The <code>&lt;background&gt;</code> directive</h3>
<p><strong>NOT DONE</strong></p>
<p>It can be useful to display a background image behind plot data. This is particularly useful for geospatial data where it’s important to show a map image to help locate data. Since plots are rendered as SVG, this is the easiest format to deal with (made easier by the fact that SVG files define a coordinate system), but it’s also important to handle raster image formats (only PNG for now).</p>
<p>Given a background image, we may need to assign coordinate ranges (mandatory for PNG files) or clip the image within the plot frame. Background images are implemented using the <code>&lt;background&gt;</code> directive.</p>
<h6 id="attributes-7">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>SRC</code></td>
<td align="left">URL for background source (either an SVG or a PNG)</td>
</tr>
<tr class="even">
<td align="left"><code>X</code></td>
<td align="left">Data path or range defining <span class="math"><em>x</em></span>-coordinate range for image (overrides any native coordinates in SVG files)</td>
</tr>
<tr class="odd">
<td align="left"><code>Y</code></td>
<td align="left">Data path or range defining <span class="math"><em>y</em></span>-coordinate range for image (overrides any native coordinates in SVG files)</td>
</tr>
<tr class="even">
<td align="left"><code>CLIP-X</code></td>
<td align="left">Data path or range defining clipping x-coordinate range for image</td>
</tr>
<tr class="odd">
<td align="left"><code>CLIP-Y</code></td>
<td align="left">Data path or range defining clipping y-coordinate range for image</td>
</tr>
</tbody>
</table>
<h6 id="body-7">Body</h6>
<p>None</p>
<h6 id="interpretation-6">Interpretation</h6>
<p>The background image is loaded from the given URL and is rendered into the plot area. For SVG files, if <code>X</code> and <code>Y</code> attributes are not specified, the coordinates defined in the SVG file are assumed to refer directly to plot coordinates. The <code>X</code> and <code>Y</code> attributes can be used to override this coordinate range assignment. For PNG files, the use of the <code>X</code> and <code>Y</code> attributes to assign coordinate ranges is mandatory.</p>
<p>The background image can further be clipped by specifying values for the <code>CLIP-X</code> and/or <code>CLIP-Y</code> attributes.</p>
<h6 id="examples-7">Examples</h6>
<p>Basic SVG example with clipping to the latitude/longitude range of a set of case data: <code>html &lt;plot&gt;   &lt;background src=&quot;http://www.bayeshive.com/assets/maps/europe-political.svg&quot;                clip-x=&quot;[[cases#lon]]&quot; clip-y=&quot;[[cases#lat]]&quot;/&gt;   &lt;points x=&quot;[[cases#lon]]&quot; y=&quot;[[cases#lat]]&quot;           marker=&quot;[[{circle;square}(cases#sex)]]&quot;           size=&quot;[[{linear 1 3}(cases#age)]]&quot;/&gt; &lt;/plot&gt;</code></p>
<p>Basic PNG example using UK National Grid coordinates to show GPS track data over a background map: <code>html &lt;plot&gt;   &lt;background src=&quot;http://www.bayeshive.com/assets/maps/central-london.png&quot;               x=&quot;520520,540520&quot; clip-y=&quot;151830,171830&quot;/&gt;   &lt;lines x=&quot;[[track#ng_x]]&quot; y=&quot;[[track#ng_y]]&quot; stroke=&quot;black&quot; stroke-width=2/&gt; &lt;/plot&gt;</code></p>
<h2 id="palettes-and-interpolators">Palettes and interpolators</h2>
<p>The subject of colour palettes and interpolators for properties like stroke width are closely related. A palette is just a sort of colour interpolator. The slightly different uses of palettes compared to general scalar interpolators suggest slightly different syntax and features for the two cases.</p>
<h3 id="palette-definitions">Palette definitions</h3>
<p>A palette is used to map input values from some domain to colour values. The mapping may be a discrete mapping (from discrete values taken by a variable to discrete colour values), an absolute mapping (from fixed variable values to colours) or a normalised mapping (from the range [0,1] to a range of colours, with the understanding that data values used with the palette will somehow be normalised to [0,1]). For non-discrete palettes, the interpolation between specified (value,colour) pairs is either linear (in RGB, HSL, HCL or Lab given colour space ) or constant (giving a “banded” palette). For example, a scale for temperatures might have a linear HSL interpolation between blue (for cold temperatures) and red (for warm), while a palette for topographic elevation would be absolute banded, with fixed colours being used for fixed elevation ranges.</p>
<p>A suitable Haskell datatype to represent palettes is thus: <code>haskell data Colour = Colour { colRed, colGreen, colBlue :: Double } data Banded = Banded | Linear data ColInterp = RGB | HSL | HCL | Lab data Palette = Discrete   [Colour]              | Normalised ColInterp Banded [(Fraction, Colour)]              | Absolute   ColInterp Banded [(Double, Colour)]</code> (Here, <code>Fraction</code> is a type representing values lying in [0,1].)</p>
<p>Palettes are defined in HTML <code>&lt;palette&gt;</code> directives:</p>
<h6 id="attributes-8">Attributes</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>NAME</code></td>
<td align="left">Standard</td>
</tr>
<tr class="even">
<td align="left"><code>TYPE</code></td>
<td align="left">One of <code>discrete</code>, <code>abs</code> or <code>norm</code> (default)</td>
</tr>
<tr class="odd">
<td align="left"><code>BANDED</code></td>
<td align="left">Present/absent</td>
</tr>
<tr class="even">
<td align="left"><code>INTERP</code></td>
<td align="left">One of <code>RGB</code>, <code>HSL</code> (default), <code>HCL</code> or <code>Lab</code></td>
</tr>
</tbody>
</table>
<h6 id="body-8">Body</h6>
<p>If <code>TYPE</code> = “discrete”: either <code>&lt;colour&gt;</code> ( { “<code>;</code>” | “<code>\n</code>” } <code>&lt;colour&gt;</code> )* or <code>&lt;dvalue&gt;</code> <code>&lt;colour&gt;</code> ( { “<code>;</code>” | “<code>\n</code>” } <code>&lt;dvalue&gt;</code> <code>&lt;colour&gt;</code> )*</p>
<p>Otherwise: <code>&lt;value&gt;</code> <code>&lt;colour&gt;</code> ( { “<code>;</code>” | “<code>\n</code>” } <code>&lt;value&gt;</code> <code>&lt;colour&gt;</code> )*</p>
<p>Here <code>&lt;value&gt;</code> is a real number, <code>&lt;colour&gt;</code> is a colour specifier (either a colour name, or a <code>#XXX</code> or <code>#XXXXXX</code> value) and <code>&lt;dvalue&gt;</code> is a discrete palette value (normally a value from a set of strings, e.g. <code>male</code> or <code>female</code> – discrete palette values can be quoted with double quotes, in order to allow keys containing spaces).</p>
<h6 id="interpretation-7">Interpretation</h6>
<p>Discrete palettes give a simple list of colours, which are used one-by-one to colour categorical values – this is implemented by deriving a zero-based index <em>i</em> from the data categories and taking the <em>(i mod n)</em>’th colour from the palette, where <em>n</em> is the number of colours in the palette.</p>
<p>Absolute and normalised palettes both work in a similar fashion, either interpolating linearly between the (value, colour) set points of the palette or (for banded palettes) returning a fixed colour for each value range between set points. The only difference between absolute and normalised palettes is that, for absolute palettes, the actual data values are used to define the set points, while for normalised palettes, the set point values all lie in [0,1] and data values are normalised to this range before calculating colours from the palette (the normalisation is a simple linear mapping of [min <em>D</em>, max <em>D</em>] to [0,1], where <em>D</em> is the set of data values).}</p>
<h6 id="examples-8">Examples</h6>
<p>Palette for display of topographic data: <code>html &lt;palette name=&quot;terrain&quot; type=&quot;abs&quot; banded&gt;   -8000.0 #000066; -4000.0 #4C4CFF; -1000.0 #7F7FFF; -500.0 #66B2FF    -100.0 #7FFFFF;   -50.0 #66CCB2;    -0.1 #E5FFFF;    0.0 #003300     100.0 #00B24C;   500.0 #E5FF00;  1200.0 #994C00; 4000.0 #E5E5FF    5000.0 #FFFFFF &lt;/palette&gt;</code></p>
<p>Simple discrete colour palette: <code>html &lt;palette name=&quot;colours&quot; type=&quot;discrete&quot;&gt;   orange; green; blue; red; black &lt;/palette&gt;</code></p>
<p>Palette for blue-to-red temperature scale: <code>html &lt;palette name=&quot;temppal&quot; type=&quot;norm&quot;&gt;   0 #0000FF; 1 #FF0000 &lt;/palette&gt;</code> Note that, in the last case, there is a compact direct representation of the palette that <a href="#palette-use">may be used</a>.</p>
<h3 id="palette-use-and-compact-palette-syntax"><a name="palette-use">Palette use and compact palette syntax</a></h3>
<p><strong>Not done: application of palettes to stroke along paths, i.e. passing a palette function as the stroke.</strong></p>
<p>Palettes are used to specify colours for stroking and filling SVG elements in plots. (Note that in all the following examples, the stroke or fill attribute can actually contain a semicolon-separated list of colour/palette specifiers, allowing for <a href="#ui-stroke-sel">stroke switching</a>. <strong>(Stroke switching is currently broken while I work on palettes.)</strong></p>
<p>Palettes defined using <code>&lt;palette&gt;</code> directives are installed as functions (with names taken from the directive’s <code>NAME</code> attribute) that can be called to assign colours based on Radian variables. For <em>ad hoc</em> palette use, there is a compact syntax for defining palette functions “in place”.</p>
<p>The most basic instance is using a single colour to specify the stroke or fill for an element: <code>stroke=&quot;red&quot;</code> <code>fill=&quot;#CC3342&quot;</code></p>
<p>To make use of a palette, we need to provide a palette specifier, <em><code>palspec</code></em> and, optionally, a data path <em><code>dataspec</code></em> describing the data item to be used to generate colours from the palette:</p>
<p><code>stroke = &quot;@P{</code><em><code>palspec</code></em><code>}(</code><em><code>dataspec</code></em><code>)&quot;</code> <code>fill = &quot;@P{</code><em><code>palspec</code></em><code>}&quot;</code></p>
<p>In the second case, where no data path is given, the data item index is used to index into the palette. For path stroking, this gives palette interpolation along the path.</p>
<p>To support the simplest use case, there is a compact syntax for normalised linear interpolation between two colours:</p>
<p><code>stroke = &quot;@P{grey:red}&quot;</code> <code>fill = &quot;@P{grey:red}(station#startDate)&quot;</code></p>
<p>These are equivalent to defining a normalised HSL interpolation palette whose 0 value is “grey” and whose 1 value is “red”, the first along the path to be stroked and the second as a function of the <code>station#startDate</code> variable.</p>
<p>More generally, if a palette is defined by a <code>&lt;palette&gt;</code> element with a suitable <code>NAME</code> attribute, the palette can be accessed directly as a function, for example:</p>
<p><code>fill = &quot;terrainpal(stations#elevation)&quot;</code></p>
<p>Here, the <code>terrainpal</code> palette must be defined within the current document using a <code>&lt;palette&gt;</code> element.</p>
<p>Palette definitions can also be included inline:</p>
<p><code>fill = &quot;@P{discrete red;green;blue}(station#type)&quot;</code> <code>fill = &quot;@P{norm 0 blue; 0.5 blue; 0.5 green; 1 red}(x)&quot;</code> <code>fill = &quot;@P{abs rgb -4000 black; 8000 green}(station#elevation)&quot;</code></p>
<p>The first example here defines a three element discrete palette, the second a normalised HSL interpolation palette and the third an absolute RGB interpolation palette.</p>
<p>The general syntax of a palette use is: ``` paluse ::= colour | “@P{” palspec “}” [ “(” [datapath] “)” ]</p>
<p>palspec ::= colour “:” colour | colour ( “;” colour )* | type [interp][&quot;banded&quot;] value colour (“;” value colour)+</p>
<p>type ::= “normalised” | “absolute” | “discrete” interp ::= “RGB” | “HSL” | “HCL” | “Lab” ```</p>
<p>The <code>type</code> can be abbreviated to <code>n</code>, <code>a</code> or <code>d</code>.</p>
<h3 id="general-interpolation">General interpolation</h3>
<p>As well as the specialised interpolation provided by palettes, there is a general interpolation facility exposed via the <code>interpolate</code> function in the Radian plotting library. This function is called as <code>interpolate(domain, range, type)</code> where <code>domain</code> and <code>range</code> are (possibly nested) arrays of values, and <code>type</code> is one of <code>linear</code>, <code>sqrt</code>, <code>log</code> or <code>pow:k</code> (with <code>k</code> a numeric exponent). The return value of a call to <code>interpolate</code> is an interpolation function whose domain covers the values in <code>domain</code>, whose range is the range of values in <code>range</code> and has an interpolation law as specified by <code>type</code>.</p>
<p>The following example demonstrates how marker <em>areas</em> can be related to plot data: <code>html &lt;plot height=500 stroke-width=1       szint=&quot;[[interpolate(d#size,[1,1000],'sqrt')]]&quot;&gt;   &lt;points x=&quot;d#x&quot; y=&quot;d#y&quot; fill=&quot;[[category10(d#cat)]]&quot;           marker-size=&quot;[[szint(d#size)]]&quot;&gt;   &lt;/points&gt; &lt;/plot&gt;</code></p>
<h2 id="user-interface-features">User interface features</h2>
<h3 id="plot-visibility-switching">Plot visibility switching</h3>
<p><strong>This is partially done in a shonky way with the <code>LEGEND-SWITCHES</code> attribute, but this needs to be managed in a much more coherent way.</strong></p>
<h3 id="pan-and-zoom">Pan and zoom</h3>
<p><strong>Not done: y-zooming, 2D pan and zoom.</strong></p>
<p>The <code>ZOOM-X</code> and <code>ZOOM-Y</code> attributes on the <code>&lt;plot&gt;</code> directive enable a focus/context plot setup, where a draggable region of a context plot is displayed in a focus panel, subsetting either in the x-direction (<code>ZOOM-X</code>) or the y-direction (<code>ZOOM-Y</code>). The user interface interaction and management is entirely self-contained within the rendering of the <code>&lt;plot&gt;</code> directive and any embedded plotting directives.</p>
<h3 id="stroke-selection"><a name="ui-stroke-sel">Stroke selection</a></h3>
<p>It is possible to specify multiple stroke palettes for plot elements using a semicolon separated list of options for the <code>STROKE</code> attribute. Switching between these options is controlled by the UI enabled by the <code>STROKE-SWITCH</code> attribute on the <code>&lt;plot&gt;</code> or <code>&lt;plot-grid&gt;</code> directives. This allows for switching between two stroke choices (by giving a single UI element label for <code>STROKE-SWITCH</code>, which is used to label a toggle button), or for switching between multiple choices (by giving multiple semicolon-separated UI labels for <code>STROKE-SWITCH</code>, which are used as labels for a selection UI element).</p>
<p>The actual switching of stroke palettes is controlled by the Angular custom <code>strokeSelChange</code> event: this is emitted by the standard plotting UI which is included as an element in the Angular template for the <code>&lt;plot&gt;</code> and <code>&lt;plot-grid&gt;</code> directives and is responded to by the logic in the <code>&lt;plot&gt;</code> directive. It is thus possible to disable the standard UI and emit the appropriate events oneself.</p>
<h3 id="data-selection">Data selection</h3>
<p>The <code>SELECT-X</code> and <code>SELECT-Y</code> attributes on the <code>&lt;plot&gt;</code> and <code>&lt;plot-grid&gt;</code> directives make it possible to switch between different choices for the x- and y-coordinate data of plot elements. The standard UI for this uses normal select UI elements, linked together to ensure that only reasonable combinations of variables can be selected. As for the stroke selection though, the change in data items is managed using custom Angular events (<code>xDataSelChange</code> and <code>yDataSelChange</code>), so the standard UI can easily be overridden.</p>
<h2 id="plot-layout-directives">Plot layout directives</h2>
<p>A number of directives are provided for laying out plots using a “VBox/HBox” approach (<code>&lt;plot-row&gt;</code> and <code>&lt;plot-col&gt;</code>) and in simple grids (<code>&lt;plot-grid&gt;</code>).</p>
<p>All of the plot layout directives can be embedded one inside the other, forming a layout tree, the leaves of which are normal <code>&lt;plot&gt;</code> directives. So, rows can be items inside columns, columns can items be inside grids, grids can be items inside rows, and so on. The outermost layout directive (this includes a <code>&lt;plot&gt;</code> directive on its own) is responsible for allocating space within the main layout frame for the subsidiary plots. The overall height, width and aspect ratio of the plot layout can therefore be set on the outermost layout element.</p>
<p>As with most Radian directives, plot attributes and other Radian variables can be specified for all the plots inside the directive. In addition, each of the layout directives supports a number of specialised layout attributes:</p>
<h6 id="layout-attributes-for-the-plot-grid-directive">Layout attributes for the <code>&lt;plot-grid&gt;</code> directive</h6>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ROWS</code></td>
<td align="left">Number of rows in plot grid</td>
</tr>
<tr class="even">
<td align="left"><code>COLS</code></td>
<td align="left">Number of columns in plot grid</td>
</tr>
<tr class="odd">
<td align="left"><code>SPACING</code></td>
<td align="left">Spacing between layout elements in pixels</td>
</tr>
</tbody>
</table>
<p>If either or both of the <code>ROWS</code> or <code>COLS</code> attributes is missing, sensible defaults are chosen based on the number of items inside the <code>&lt;plot-grid&gt;</code> directive.</p>
<h6 id="layout-attributes-for-the-plot-row-and-plot-col-directives">Layout attributes for the <code>&lt;plot-row&gt;</code> and <code>&lt;plot-col&gt;</code> directives</h6>
<p>The only special attribute for these two directives is <code>LAYOUT-SHARE</code>, which can be applied to the elements within the <code>&lt;plot-row&gt;</code> or <code>&lt;plot-col&gt;</code> directives to specify proportionally how much space in the “layout direction” should be allocated to each element: setting <code>LAYOUT-SHARE</code> to 1 for one element and 2 for another element means that the second element will be allocated twice as much space as the first. Elements without a <code>LAYOUT-SHARE</code> value are allocated space corresponding to the mean size of all elements.</p>
<h6 id="examples-9">Examples</h6>
<p>The functionality of these directives is best understood through examples.</p>
<p>Two plots laid out side-by-side, both allocated the same amount of space, and both (because of the <code>ASPECT</code> setting) square: <code>html &lt;plot-row height=300 aspect=2 x=&quot;[[seq(0,2*PI,101)]]&quot;&gt;   &lt;plot&gt;     &lt;lines y=&quot;[[sin(x)]]&quot;&gt;&lt;/lines&gt;   &lt;/plot&gt;   &lt;plot&gt;     &lt;lines y=&quot;[[cos(x)]]&quot;&gt;&lt;/lines&gt;   &lt;/plot&gt; &lt;/plot-row&gt;</code></p>
<p>A nested layout with varying size ratios – the second column is three times the width of the first, and because of the height and width choices, all of the plots are square: <code>html &lt;plot-row height=600 width=800 x=&quot;[[seq(0,2*PI,101)]]&quot;&gt;   &lt;plot-col layout-share=1&gt;     &lt;plot title=&quot;Copy 1&quot;&gt;       &lt;lines y=&quot;[[sin(x)]]&quot;&gt;&lt;/lines&gt;     &lt;/plot&gt;     &lt;plot title=&quot;Copy 2&quot;&gt;       &lt;lines y=&quot;[[sin(x)]]&quot;&gt;&lt;/lines&gt;     &lt;/plot&gt;     &lt;plot title=&quot;Copy 3&quot;&gt;       &lt;lines y=&quot;[[sin(x)]]&quot;&gt;&lt;/lines&gt;     &lt;/plot&gt;   &lt;/plot-col&gt;   &lt;plot layout-share=3&gt;     &lt;lines y=&quot;[[cos(x)]]&quot;&gt;&lt;/lines&gt;   &lt;/plot&gt; &lt;/plot-row&gt;</code></p>
<h2 id="use-cases">Use cases</h2>
<h3 id="historical-time-series">Historical time series</h3>
<p>First thing to note is that data for plots is separated out from the representation of individual plots. This allows the same data to be used for multiple plots. The <code>&lt;plot-data&gt;</code> directive is used to specify data sets for plotting, either directly within the directive, or indirectly via a URL using the <code>SRC</code> attribute (one of the examples below demonstrates this). The <code>&lt;plot-data&gt;</code> directive is given an ID which is used to refer to the data set in plots.</p>
<p>Other attributes on the <code>&lt;plot-data&gt;</code> directive specify the data format (defaults to JSON, with <code>&quot;csv&quot;</code> being another possibility, and perhaps some forms of binary data encoded as CDATA) and other information needed to parse the data (a list of column names for CSV files, for instance).</p>
<p>Within the body of the <code>&lt;plot-data&gt;</code> directive are optional <code>&lt;metadata&gt;</code> directives which encoded information about default label names and units for individual data fields, and the data (when it’s not specified via a URL).</p>
<p>The following example gives a CSV data set of historical global temperature data: <code>html &lt;plot-data id=&quot;globaltemp&quot; format=&quot;csv&quot; cols=&quot;date,temp,error&quot;&gt;   &lt;metadata name=&quot;date&quot; format=&quot;isodate&quot;&gt;&lt;/metadata&gt;   &lt;metadata name=&quot;temp&quot; label=&quot;Global mean temperature&quot; units=&quot;&amp;deg;C&quot;&gt;&lt;/metadata&gt;   &lt;metadata name=&quot;error&quot; error-for=&quot;temp&quot;&gt;&lt;/metadata&gt; &quot;1970-01-15&quot;, 17.352, 0.100 &quot;1970-02-14&quot;, 16.936, 0.090 &quot;1970-03-15&quot;, 17.029, 0.095 &quot;1970-04-15&quot;, 17.550, 0.087 ... &lt;/plot-data&gt;</code></p>
<p>Plots are specified within a <code>&lt;plot&gt;</code> directive, which represents any number of data sets displayed on common axes. The ranges of the axes are normally determined from the plot data, but can also be specified using <code>range-x</code> and <code>range-y</code> (or <code>range</code>) attributes if required. In these attributes, as in other locations, values from plot data sets are represented by data paths, which are expressions in JavaScript with the addition of a “pluck” operator (represented by <code>#</code>). Data access paths are normally pluck or member access expressions, e.g. <code>id#var#field</code> where <code>id</code> is the ID of a <code>&lt;plot-data&gt;</code> directive, and <code>var#field</code> is a path through hierarchical data objects. The pluck operator is useful for arrays of objects whose fields need to be plucked out to form arrays of plot values. In the simple cases here, <code>globaltemp#date</code> accesses the date column of the plot data specified above. Other attributes on the <code>&lt;plot&gt;</code> directive control axis transforms, e.g. <code>axis-y-transform=&quot;log&quot;</code> (or <code>&quot;z-score&quot;</code> or <code>&quot;invlogit&quot;</code> or other reasonable possibilities).</p>
<p>Within a <code>&lt;plot&gt;</code> directive, the display of individual data sets is controlled by directives like <code>&lt;lines&gt;</code>, the attributes of which specify data sets to be plotted (in order from bottom to top in terms of z-order) and plot attributes (e.g. <code>stroke</code> and <code>stroke-width</code>). Plot values are either given as dataset paths or as JavaScript functions.</p>
<p>This example plots a time series based on the given data (including error bars, which for a line plot are displayed as bands around the data, and for a point data set are displayed as normal error bars), with an exponential fit line superimposed. Axis labels and units will be taken from the defaults provided in the <code>&lt;plot-data&gt;</code> directive. <code>html &lt;plot&gt;   &lt;lines x=&quot;[[globaltemp#date]]&quot; y=&quot;[[globaltemp#temp]]&quot;          y-error=&quot;[[globaltemp#error]]&quot; stroke=&quot;blue&quot; stroke-width=1/&gt;   &lt;lines ref=&quot;[[(new Date(&quot;1970-01-01&quot;)).jd]]&quot; x=&quot;[[globaltemp#date]]&quot;          y=&quot;[[17.0 + 0.0012 * exp((x.jd - ref.jd) / 1453)]]&quot;          stroke=&quot;black&quot; stroke-width=2/&gt; &lt;/plot&gt;</code></p>
<h3 id="simulation-time-series-from-ds-builder">Simulation time series (from DS builder)</h3>
<p>Being able to include data sets directly into a document makes it easy to include data sets created on the fly, for instance: <code>html &lt;plot-data id=&quot;sim1&quot; format=&quot;csv&quot; cols=&quot;t,x,y,z&quot;&gt; 0.00,1.000,1.000,1.000 0.01,1.001,1.002,0.995 ... &lt;/plot-data&gt;</code></p>
<p>To handle compositing of plots, a single <code>&lt;plot-grid&gt;</code> directive is provided. This has attributes <code>rows</code>, <code>cols</code> and <code>tabs</code> that control, respectively, horizontal and vertical juxtaposition of plots and “stacking” of plots (using labelled tabs within the browser). Nesting of <code>&lt;plot-grid&gt;</code> elements allows for arbitrary juxtaposition of plots.</p>
<p>In the following example, two plots are stacked with tabs to switch between them. The first is a time series plot with a zoom panel and a legend allowing for individual traces to be switched on or off, and the second is an X/Y line plot where the variable plotted on the X and Y axes can be selected from a drop-down list, and where colour fading along the traces is available as an option: <code>html &lt;plot-grid tabs&gt;   &lt;plot zoom-x title=&quot;Time series&quot; stroke-width=2 legend-switches&gt;     &lt;lines x=&quot;[[sim1.t]]&quot; y=&quot;[[sim1.x]]&quot; stroke=&quot;orange&quot;/&gt;     &lt;lines x=&quot;[[sim1.t]]&quot; y=&quot;[[sim1.y]]&quot; stroke=&quot;blue&quot;/&gt;     &lt;lines x=&quot;[[sim1.t]]&quot; y=&quot;[[sim1.z]]&quot; stroke=&quot;green&quot;/&gt;   &lt;/plot&gt;   &lt;plot title=&quot;Trajectories&quot; stroke-switch=&quot;Fade&quot;         select-x=&quot;x,y,z&quot; select-y=&quot;x,y,z&quot;&gt;     &lt;lines x=&quot;[[[sim1.x,sim1.y,sim1.z]]]&quot; y=&quot;[[[sim1.x,sim1.y,sim1.z]]]&quot;            stroke=&quot;blue;red:grey&quot;/&gt;   &lt;/plot&gt; &lt;/plot-grid&gt;</code></p>
<h3 id="broad-street-cholera-map">Broad Street cholera map</h3>
<p>Including JSON data is simple, as is accessing data from a URL: <code>html &lt;plot-data id=&quot;pumps&quot;&gt;   [ { &quot;name&quot;: &quot;Broad Street&quot;, &quot;lat&quot;: 51.02345, &quot;lon&quot;: 0.02345 },     { &quot;name&quot;: &quot;Other&quot;,        &quot;lat&quot;: 51.05445, &quot;lon&quot;: 0.04538 } ] &lt;/plot-data&gt; &lt;plot-data id=&quot;cases&quot; src=&quot;http://.../cholera-cases.csv&quot;            format=&quot;csv&quot; cols=&quot;date,lat,lon&quot;/&gt;</code></p>
<p>Since plots are rendered as SVG, it is possible to include SVG background images. Here, the coordinate range of a plot is taken from the bounding box of the SVG file used as a background, thus clipping the other data plotted to this coordinate range. Axis display is suppressed (the SVG file is supposed to be a map of the streets in the area of John Snow’s cholera study). Superimposed on the background image are points representing water pumps (rendered as image specified by a URL) and points representing cholera case occurrence (coloured by hues linearly interpolated between red and blue covering the range of dates of occurrence): <code>html &lt;plot range=&quot;http://.../basemap.svg&quot; axis-x=&quot;off&quot; y-axis=&quot;off&quot;&gt;   &lt;background src=&quot;http://.../basemap.svg&quot;&gt;   &lt;points x=&quot;[[pumps#lon]]&quot; y=&quot;[[pumps#lat]]&quot; marker-size=&quot;16px&quot;           marker=&quot;http://.../pump.png&quot; legend=&quot;Pumps&quot;/&gt;   &lt;points x=&quot;[[cases#lon]]&quot; y=&quot;[[cases#lat]]&quot; stroke=&quot;none&quot;           fill=&quot;[[{red:blue}(cases#date)]]&quot; marker-size=&quot;2px&quot; legend=&quot;Cases&quot;/&gt; &lt;/plot&gt;</code></p>
<h3 id="categorical-bar-chart">Categorical bar chart</h3>
<p>Here, we have some JSON data with discrete labels in three different directions, plus real-valued measurements: <code>html &lt;plot-data id=&quot;d1&quot;&gt;   [ { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;55-59&quot;, &quot;rate&quot;: 20.2 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;60-64&quot;, &quot;rate&quot;: 32.1 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;65-69&quot;, &quot;rate&quot;: 48.0 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;70-74&quot;, &quot;rate&quot;: 65.5 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;55-59&quot;, &quot;rate&quot;: 20.2 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;60-64&quot;, &quot;rate&quot;: 32.1 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;65-69&quot;, &quot;rate&quot;: 48.0 },     { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;70-74&quot;, &quot;rate&quot;: 65.5 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;55-59&quot;, &quot;rate&quot;: 20.2 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;60-64&quot;, &quot;rate&quot;: 32.1 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;65-69&quot;, &quot;rate&quot;: 48.0 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;70-74&quot;, &quot;rate&quot;: 65.5 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;55-59&quot;, &quot;rate&quot;: 20.2 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;60-64&quot;, &quot;rate&quot;: 32.1 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;65-69&quot;, &quot;rate&quot;: 48.0 },     { &quot;sex&quot;: &quot;male&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;70-74&quot;, &quot;rate&quot;: 65.5 } ] &lt;/plot-data&gt;</code></p>
<p>A simple bar plot can be constructed that displays categorical relationships in the data. Here, the specification <code>d1#age;d1#env,d1#sex</code> for the X-value indicates that data groups distinguished by age range should be separated while bars for different values of the environment and gender should be plotted together (see http://gallery.r-enthusiasts.com/graph/standard_bar_plot,58): <code>html &lt;plot&gt;   &lt;bars x=&quot;[[[[d1#age,d1#env],d1#sex]]]&quot; y=&quot;[[d1#rate]]&quot;/&gt; &lt;/plot&gt;</code></p>
<h3 id="miscellaneous-unclassified">Miscellaneous unclassified</h3>
<p>Background map with marker plot and track: <code>html &lt;plot zoom-2d x1-axis=&quot;none&quot; y1-axis=&quot;none&quot;&gt;   &lt;background src=&quot;http://www.bayeshive.com/data/1/map1.svg&quot;&gt;   &lt;plot-options stroke-width=1 stroke=&quot;#000&quot;&gt;     &lt;points x=&quot;[[stations#lon]]&quot; y=&quot;[[stations#lat]]&quot; marker=&quot;circle&quot;             fill=&quot;[[{#terrain}(stations#elevation)]]&quot;             marker-size=&quot;[[{linear 1 3}(stations#temp)]]&quot;/&gt;     &lt;points x=&quot;[[model#lon]]&quot; y=&quot;[[model#lat]]&quot; marker=&quot;diamond&quot;             fill=&quot;none&quot; stroke=&quot;red&quot;             marker-size=&quot;[[{linear 1 3}(model#temp)]]&quot;/&gt;   &lt;/plot-options&gt;   &lt;lines x=&quot;[[track#lon]]&quot; y=&quot;[[track#lat]]&quot; stroke=&quot;grey&quot; stroke-width=2/&gt; &lt;/plot&gt;</code></p>
<p>Bubble chart with scrubbable UI: <code>html &lt;plot width=500 height=300 year=1870 stroke=&quot;black&quot; stroke-width=1       axis-x-label=&quot;GDP&quot; axis-y-label=&quot;Life expectancy&quot;&gt;   &lt;points i=&quot;[[year-1870]]&quot; x=&quot;[[dat[i].gdp]]&quot; y=&quot;[[dat[i].lifeexp]]&quot;           marker=&quot;circle&quot; fill=&quot;[[dat[i].continent]]&quot;           size=&quot;[[{quadratic(dat#pop) 0 10}(dat[i].pop)]]&quot;/&gt;   &lt;scrubbable ng-model=&quot;year&quot; lower=&quot;1870&quot; upper=&quot;2010&quot; round=0/&gt; &lt;/plot&gt;</code></p>
<p>(Here, CSS would be used to position the <code>&lt;scrubbable&gt;</code> within the plot frame.)</p>
<h2 id="other-features">Other features</h2>
<p>The following things need to be thought about:</p>
<ol style="list-style-type: decimal">
<li><p>Plot legends: positioning (inside/outside plot frame and location); legend elements to be displayed; labels, boxes, titles and other formatting issues; user interaction (show/hide specific plot elements, collapsible UI?).</p></li>
<li><p>Tooltips for individual data points (configurable, both in terms of whether they’re shown at all and in terms of the content of the tooltips).</p></li>
<li><p>Rendering efficiency for pan and zoom (bitmaps, background rendering, etc.).</p></li>
<li><p>Rendering efficiency for fade paths: at the moment, a separate path element is defined for every data point, which is really inefficient and slows down plotting noticeably; instead, it should be possible to specify that only a certain number of “fade steps” are used along the path (in cases where a banded palette is used, new path elements only need to be created when a stroke colour change is required).</p></li>
<li><p>Handling of missing values, NaNs and infinite values in input data.</p></li>
<li><p>Two-dimensional pan and zoom.</p></li>
<li><p>Arbitrary plot annotations: text, overdrawing, etc.</p></li>
<li><p>Plot titles.</p></li>
<li><p>Easy access to ColorBrewer colour sets.</p></li>
<li><p>Stroke dash handling.</p></li>
<li><p>Other plot types: heatmap, contour plots, marker plots, box plots.</p></li>
</ol>
<h2 id="appendix-reserved-names"><a name="reserved">Appendix: Reserved names</a></h2>
<h3 id="directives">Directives</h3>
<p>The following directive names are reserved and implemented by the plotting library: <code>&lt;area&gt;</code>, <code>&lt;background&gt;</code>, <code>&lt;bars&gt;</code>, <code>&lt;lines&gt;</code>, <code>&lt;metadata&gt;</code>, <code>&lt;palette&gt;</code>, <code>&lt;plot&gt;</code>, <code>&lt;plot-data&gt;</code>, <code>&lt;plot-grid&gt;</code>, <code>&lt;plot-options&gt;</code>, <code>&lt;points&gt;</code>.</p>
<h3 id="attributes-9">Attributes</h3>
<p>The following attributes names are reserved for use by plotting library directives: <code>axis-x</code>, <code>axis-x-label</code>, <code>axis-x2</code>, <code>axis-y</code>, <code>axis-y-label</code>, <code>axis-y2</code>, <code>banded</code>, <code>clip-x</code>, <code>clip-y</code>, <code>cols</code>, <code>error-for</code>, <code>fill</code>, <code>fill-opacity</code>, <code>format</code>, <code>id</code>, <code>interp</code>, <code>label</code>, <code>legend-switches</code>, <code>marker</code>, <code>marker-size</code>, <code>name</code>, <code>range</code>, <code>range-x</code>, <code>range-y</code>, <code>rows</code>, <code>select-x</code>, <code>select-y</code>, <code>separator</code>, <code>src</code>, <code>stroke</code>, <code>stroke-opacity</code>, <code>stroke-switch</code>, <code>stroke-width</code>, <code>tabs</code>, <code>title</code>, <code>type</code>, <code>units</code>, <code>x</code>, <code>x2</code>, <code>y</code>, <code>y2</code>, <code>zoom-2d</code>, <code>zoom-x</code>, <code>zoom-y</code>.</p>
<p>Any other attribute name applied to a plotting directive brings a name into scope for data access expression evaluation.</p>
<h2 id="mlack">Mlack</h2>
<h3 id="user-interface-1">User interface 1</h3>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot-grid</span><span class="ot"> tabs</span><span class="kw">&gt;</span>
  <span class="kw">&lt;plot</span><span class="ot"> title=</span><span class="st">&quot;Time series&quot;</span><span class="kw">&gt;</span>
    ...
  <span class="kw">&lt;plot</span><span class="ot"> title=</span><span class="st">&quot;Trajectories&quot;</span><span class="kw">&gt;</span>
    ...</code></pre>
<p>could become something like:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> ng-show=</span><span class="st">&quot;...&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;span</span> <span class="er">.form-inline</span><span class="kw">&gt;</span>
      <span class="kw">&lt;span</span> <span class="er">.btn-group</span><span class="ot"> data-toggle=</span><span class="st">&quot;buttons-radio&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;button</span><span class="ot"> ng-repeat=</span><span class="st">&quot;panel in bhUI.panels&quot;</span> <span class="er">#{{panel.id}}</span> <span class="er">.btn</span>
<span class="ot">                ng-click=</span><span class="st">&quot;bhUI.activePanel={{\$index}}&quot;</span><span class="kw">&gt;</span>
          {{panel.label}}
    ...
    <span class="kw">&lt;div</span><span class="ot"> ng-show=</span><span class="st">&quot;bhUI.activePanel==0&quot;</span><span class="kw">&gt;</span>
      ...
    <span class="kw">&lt;div</span><span class="ot"> ng-show=</span><span class="st">&quot;bhUI.activePanel==1&quot;</span><span class="kw">&gt;</span>
      ...
    <span class="kw">&lt;div</span><span class="ot"> ng-show=</span><span class="st">&quot;bhUI.activePanel==2&quot;</span><span class="kw">&gt;</span>
      ...</code></pre>
<h3 id="user-interface-2">User interface 2</h3>
<ul>
<li><p>User interface attributes that appear on individual <code>&lt;plot&gt;</code> directives apply only to those plots.</p></li>
<li><p>User interface attributes that appear on <code>&lt;plot-grid&gt;</code> attributes apply to all plots contained within the grid.</p></li>
<li><p>Plot elements search up through the DOM as far as the highest enclosing <code>&lt;plot-grid&gt;</code> element looking for relevant UI elements.</p></li>
<li><p>Changes in UI configuration are communicated to containing plots via <code>scope.\$broadcast</code>, using a custom cancellation mechanism to prevent elements lower down the containment tree from handling UI events that have already been processed higher up the tree.</p></li>
</ul>

    <footer>
      <div>
         
        <span class="pull-right">Copyright © (2013) OpenBrain
        Ltd.  </span>
      </div>
    </footer>
  </div>
  <script src="../js/jquery.js"></script>
  <script src="../js/jquery.csv.js"></script>
  <script src="../js/escodegen.browser.js"></script>
  <script src="../js/estraverse.js"></script>
  <script src="../js/d3.v2.js"></script>
  <script src="../js/angular.min.js"></script>
  <script src="../js/radian.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script>
angular.module('radianDocs', ['radian']);
function DummyCtrl() { };
  </script>
</body>
</html>
