<!doctype html>
<html lang="en" ng-app="radianDocs">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Radian - Reference manual - JavaScript data access</title>
  <link rel="icon" href="../favicon.ico" />
  <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
  <link rel="stylesheet" href="../css/style.css" type="text/css" />
  <link rel="stylesheet" href="../css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="../css/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../css/hljs.css" type="text/css" />
  <link rel="stylesheet" href="../css/radian.css" type="text/css" />
</head>
<body ng-controller="MainCtrl">
  <div class="container">
    <div class="navbar navbar-main">
      <div class="navbar-inner">
        <a class="brand" href="../index.html">Radian</a>
        <ul class="nav">
          <li><a href="../documentation.html">Documentation</a></li>
          <li><a href="../download.html">Download</a></li>
          <li><a href="../community.html">Community</a></li>
          <li><a href="../gallery">Gallery</a></li>
          <li><a href="../license.html">License</a></li>
          <li><a href="../faq.html">FAQ</a></li>
          <li><a href="../roadmap.html">Roadmap</a></li>
          <li><a href="../contact.html">Contact</a></li>
        </ul>
      </div>
    </div>

    <h1 id="javascript-data-access">1. JavaScript data access</h1>
<p>The HTML side of the plotting API uses a slight extension of the JavaScript expression syntax to express values to be plotted. Data sets can be included in HTML pages and named using the <code>&lt;plot-data&gt;</code> directive, and AngularJS data binding can be used to access arbitrary values from page UI elements or other sources.</p>
<hr>
<h2 id="the-plot-data-directive">The <code>&lt;plot-data&gt;</code> directive</h2>
<h3 id="attributes">Attributes</h3>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">   </th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>NAME</code></td>
<td align="left"></td>
<td align="left">Data set name (mandatory)</td>
</tr>
<tr class="even">
<td align="left"><code>SUBNAME</code></td>
<td align="left"></td>
<td align="left">Data set sub-name</td>
</tr>
<tr class="odd">
<td align="left"><code>FORMAT</code></td>
<td align="left"></td>
<td align="left">One of <code>csv</code> or <code>json</code> (default)</td>
</tr>
<tr class="even">
<td align="left"><code>COLS</code></td>
<td align="left"></td>
<td align="left">Column names for CSV data</td>
</tr>
<tr class="odd">
<td align="left"><code>SEPARATOR</code></td>
<td align="left"></td>
<td align="left">Separator character for columns in CSV data (defaults to “,”)</td>
</tr>
<tr class="even">
<td align="left"><code>SRC</code></td>
<td align="left"></td>
<td align="left">URL for data source</td>
</tr>
<tr class="odd">
<td align="left"><code>NG-MODEL</code></td>
<td align="left"></td>
<td align="left">Angular data binding attribute</td>
</tr>
</tbody>
</table>
<h3 id="body">Body</h3>
<p>Optionally, <code>metadata</code> directives describing the data values. If no <code>SRC</code> attribute is used to specify the data source, then the data values are included in the body of the directive in the given format.</p>
<h3 id="interpretation">Interpretation</h3>
<p>The <code>&lt;plot-data&gt;</code> directive forms an association between the name given as the <code>NAME</code> attribute of the directive and the given data set. The data set name can then be used to create data paths to access components of the data set in plotting directives (<a href="#data-accessors">see here</a>). The data set name is installed as an Angular variable in the Angular scope of the containing HTML element. If the <code>SUBNAME</code> attribute is supplied as well, then the data is installed as the <code>SUBNAME</code> field of an Angular scope variable whose name is <code>NAME</code> (this is useful for using <code>&lt;plot-data&gt;</code> in conjunction with <code>ng-repeat</code>). The <code>&lt;plot-data&gt;</code> element does not create a scope of its own. For CSV data, if no <code>COLS</code> attribute is given, the column names are taken from the first line of the data.</p>
<p>When data is loaded from a URL using the <code>SRC</code> attribute, the semantics of the <code>&lt;plot-data&gt;</code> directive are identical to the case where the data is included directly in the directive body (except for possible rendering issues if the data download takes a long time: you may see warnings from the <code>radianEval</code> function in the browser console when Radian attempts to plot the empty data set before the data has arrived – these warnings are harmless, and the plots are re-rendered when the data download is complete). Replotting is triggered if the <code>SRC</code> attribute changes, so that an expression can be used to load data from different sources specified by an expression.</p>
<p>Alternatively, the data for plotting can be bound directly to an Angular scope variable by using the <code>NG-MODEL</code> attribute. This works as it does for other Angular directives.</p>
<h3 id="examples">Examples</h3>
<h4 id="temperature-data-by-date-with-error-information">Temperature data by date with error information</h4>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot-data</span><span class="ot"> id=</span><span class="st">&quot;globaltemp&quot;</span><span class="ot"> format=</span><span class="st">&quot;csv&quot;</span><span class="ot"> cols=</span><span class="st">&quot;date,temp,error&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;date&quot;</span><span class="ot"> format=</span><span class="st">&quot;date&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;temp&quot;</span><span class="ot"> label=</span><span class="st">&quot;Global mean temperature&quot;</span><span class="ot"> units=</span><span class="st">&quot;</span><span class="dv">&amp;deg;</span><span class="st">C&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/metadata&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;error&quot;</span><span class="ot"> error-for=</span><span class="st">&quot;temp&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
&quot;1970-01-15&quot;, 17.352, 0.100
&quot;1970-02-14&quot;, 16.936, 0.090
&quot;1970-03-15&quot;, 17.029, 0.095
&quot;1970-04-15&quot;, 17.550, 0.087
...
<span class="kw">&lt;/plot-data&gt;</span></code></pre>
<h4 id="json-location-data">JSON location data</h4>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot-data</span><span class="ot"> id=</span><span class="st">&quot;pumps&quot;</span><span class="kw">&gt;</span>
  [ { &quot;name&quot;: &quot;Broad Street&quot;, &quot;lat&quot;: 51.02345, &quot;lon&quot;: 0.02345 },
    { &quot;name&quot;: &quot;Other&quot;,        &quot;lat&quot;: 51.05445, &quot;lon&quot;: 0.04538 } ]
<span class="kw">&lt;/plot-data&gt;</span></code></pre>
<hr>
<h2 id="the-metadata-directive">The <code>&lt;metadata&gt;</code> directive</h2>
<p>The <code>&lt;metadata&gt;</code> directive that may appear inside <code>&lt;plot-data&gt;</code> directives provides additional information about <code>&lt;plot-data&gt;</code> data fields that may be useful for plotting. Multiple <code>&lt;metadata&gt;</code> items may appear within a <code>&lt;plot-data&gt;</code> directive, up to one per data field.</p>
<h3 id="attributes-1">Attributes</h3>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>NAME</code></td>
<td align="left">Refers to a data field name in the enclosing<code>&lt;plot-data&gt;</code> directive (mandatory)</td>
</tr>
<tr class="even">
<td align="left"><code>FORMAT</code></td>
<td align="left">Absent or <code>date</code> (specifies dates either using flexible parsing or in restricted format given by the <code>DATE-PARSE-FORMAT</code> attribute)</td>
</tr>
<tr class="odd">
<td align="left"><code>DATE-PARSE-FORMAT</code></td>
<td align="left"><code>strftime()</code>-like date parsing format (or <code>isodate</code> to specify dates in strict ISO 8601 format)</td>
</tr>
<tr class="even">
<td align="left"><code>DATE-FORMAT</code></td>
<td align="left">Date output format for plot axes</td>
</tr>
<tr class="odd">
<td align="left"><code>LABEL</code></td>
<td align="left">Axis/legend label for the named data field</td>
</tr>
<tr class="even">
<td align="left"><code>UNITS</code></td>
<td align="left">Units for the named field</td>
</tr>
<tr class="odd">
<td align="left"><code>ERROR-FOR</code></td>
<td align="left">Names another data field for which this field is an uncertainty/error value</td>
</tr>
<tr class="even">
<td align="left"><code>CATEGORY-ORDER</code></td>
<td align="left">Semicolon-separated list of categorical values, specifying an ordering to be used for plotting.</td>
</tr>
</tbody>
</table>
<h3 id="body-1">Body</h3>
<p>None</p>
<h3 id="interpretation-1">Interpretation</h3>
<p>A <code>&lt;metadata&gt;</code> directive specifies metadata for a single field of an associated containing <code>&lt;plot-data&gt;</code> directive. This metadata either gives label and units information for axis and legend labels, marks data fields as having special formats (currently only dates, but this could be used for other things as well) and allows fields to be marked up as providing uncertainty values for other fields (this information can be used to plot error bars or uncertainty ranges).</p>
<p>The data field that the metadata corresponds to is specified using the <code>NAME</code> attribute, which is a period-separated list of field names giving a path to the field of interest.</p>
<h3 id="examples-1">Examples</h3>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;date&quot;</span><span class="ot"> format=</span><span class="st">&quot;date&quot;</span><span class="ot"> date-parse-format=</span><span class="st">&quot;isodate&quot;</span>
<span class="ot">          date-format=</span><span class="st">&quot;%e %b %Y&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
<span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;date.doy&quot;</span><span class="ot"> label=</span><span class="st">&quot;Day of year&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
<span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;temp&quot;</span><span class="ot"> label=</span><span class="st">&quot;Mean temperature&quot;</span><span class="ot"> units=</span><span class="st">&quot;</span><span class="dv">&amp;deg;</span><span class="st">C&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
<span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;error&quot;</span><span class="ot"> error-for=</span><span class="st">&quot;temp&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span></code></pre>
<hr>
<h2 id="data-accessor-syntax"><a name="data-accessors">Data accessor syntax</a></h2>
<p>Within plotting directives, data values to be plotted, as well as other plot attributes (e.g. marker size, colours, and so on) are specified using an extended JavaScript expression syntax. There are three aspects to this syntax: permitted operators, name scoping and attribute data binding, and standard functions.</p>
<p>In order to distinguish between Radian expressions and raw string values, all Radian expressions are enclosed in double square brackets, e.g. <code>[[x+y]]</code>. This is the same sort of approach as taken in Angular, where Angular expressions are enclosed in double braces. The Radian expression syntax is a superset of full JavaScript expression syntax, so is rather more flexible than the more restricted grammar supported for Angular expressions.</p>
<h3 id="data-accessor-operators">Data accessor operators</h3>
<p>Data accessor syntax allows three extensions to standard JavaScript syntax. These are intended to make it more convenient to write the kinds of expressions needed in common plot types.</p>
<p><strong>Exponentiation operator</strong> Instead of writing <code>Math.pow(x,y)</code>, one may write <code>x**y</code>. The <code>**</code> operator has a higher precedence than any other binary operator.</p>
<p><strong>Pluck operator</strong> If <code>y</code> is an identifier, the expression <code>x#y</code> is equivalent to</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">x</span>.<span class="fu">map</span>(<span class="kw">function</span>(e) { <span class="kw">return</span> <span class="ot">e</span>.<span class="fu">y</span>; )}</code></pre>
<p>while if <code>y</code> is an integer literal, <code>x#y</code> is equivalent to</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">x</span>.<span class="fu">map</span>(<span class="kw">function</span>(e) { <span class="kw">return</span> e[y]; )}</code></pre>
<p>and if <code>expr</code> is a general JavaScript expression, <code>x#(expr)</code> (note parentheses!) is equivalent to</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">x</span>.<span class="fu">map</span>(<span class="kw">function</span>(e) { <span class="kw">return</span> e[expr]; )}</code></pre>
<p>This allows fields from arrays of objects or arrays of arrays to be plucked out into flat arrays in a simple way (method “plucking” of the form <code>x#f(z)</code> is also supported). This syntax is particularly useful for JSON arrays of objects or for compound object fields within other data. For instance, if we have a data set <code>d</code> with a field <code>date</code> containing an array of date fields, we can extract the day of year of each date as a single array using the expression <code>d.date#dayOfYear()</code>. Note that the <em>only</em> possibilities for the right hand side of the <code>#</code> operator are an identifier, a literal integer or a parenthesised expression (the parentheses are necessary for disambiguation of the <code>x#y</code> and <code>x#(y)</code> cases – in the first case <code>y</code> is an identifier, in the second an expression).</p>
<p><strong>Expression vectorisation</strong> Standard functions and arithmentic operators are automatically vectorised, so that, for example, <code>sin(x)</code> calculates either the sine of a single value or an array and <code>x + y</code> adds two arrays, two scalars or a scalar and an array in the natural way. This means that we can express functional plots in a very simple way:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">300</span><span class="ot"> aspect=</span><span class="st">3</span><span class="ot"> stroke-width=</span><span class="st">1</span><span class="kw">&gt;</span>
  <span class="kw">&lt;lines</span><span class="ot"> x=</span><span class="st">&quot;[[seq(-1,1,100)]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[-x**3+x+sin(x)]]&quot;</span><span class="ot"> stroke=</span><span class="st">&quot;red&quot;</span><span class="kw">&gt;&lt;/lines&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<h3 id="name-scoping-and-data-binding-in-data-accessors">Name scoping and data binding in data accessors</h3>
<p>The following names are in scope within data accessor expressions:</p>
<ul>
<li><p>The names of all data sets defined in <code>&lt;plot-data&gt;</code> directives in Angular scopes that enclose the scope of the directive containing the Radian expression. Each data set is accessible by the name given in the <code>ID</code> attribute of its <code>&lt;plot-data&gt;</code> directive.</p></li>
<li><p>All names passed as attributes to plotting directives that are not reserved names (see list in the <a href="#reserved">Appendix</a>).</p></li>
<li><p>All Angular scope variables defined in the scope of the directive containing the expression (not that, via Angular’s prototype object inheritance chain for scopes, this includes values in outer surrounding scopes, as long as their names are not shadowed by names in inner scopes).</p></li>
<li><p>The “Radian library” functions and constants defined <a href="06-radian-plotting-library.html">here</a>.</p></li>
</ul>
<p>What this means is that it is possible to pass data values around using attributes with meaningful names. We implicitly bring data set names into scope as well as simplified standard function names to make writing plot directives quick and simple.</p>
<p>Combined with Angular’s <code>ng-model</code> data binding attribute, we can do some very powerful things in very simple ways:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;form-inline&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;label&gt;</span>Mean<span class="kw">&lt;/label&gt;</span>
  <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> ng-model=</span><span class="st">&quot;mu&quot;</span><span class="ot"> ng-init=</span><span class="st">&quot;mu=5&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;label&gt;</span><span class="dv">&amp;nbsp;&amp;nbsp;</span>Standard deviation<span class="kw">&lt;/label&gt;</span>
  <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> ng-model=</span><span class="st">&quot;sigma&quot;</span><span class="ot"> ng-init=</span><span class="st">&quot;sigma=1&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;br&gt;</span>

<span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">300</span><span class="ot"> aspect=</span><span class="st">3</span><span class="ot"> stroke-width=</span><span class="st">2</span><span class="ot"> stroke=</span><span class="st">&quot;red&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;lines</span><span class="ot"> x=</span><span class="st">&quot;[[seq(0,10,200)]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[normal(x,mu,sigma)]]&quot;</span><span class="kw">&gt;&lt;/lines&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<p>In this example, updating the values in the input text fields triggers an immediate update of the plot, pulling in the new values from the UI elements. This means that plots can be attached to arbitrary UI elements with ease. Note how names of Angular scope variables defined for instance using <code>ng-model</code> may be used within Radian expressions. The Radian expression parsing infrastructure interacts correctly with Angular data binding so that plots are regenerated when Angular expressions within Radian expressions change.</p>
<h3 id="handling-of-dates">Handling of dates</h3>
<p>Time and date data can be read using a <code>&lt;metadata&gt;</code> directive with a <code>FORMAT=&quot;date&quot;</code> attribute. Individual fields of date values can then be plucked from date data using methods of the standard JavaScript <code>Date</code> class: for instance, <code>date#getMonth()</code> extracts the month field from a series of dates. In combination with aggregation functions and arbitrary mapping functions, this allows for various complex manipulations of date data. This example shows extraction of date fields, aggregation (using the <code>unique</code> and <code>meanBy</code> functions) and the use of a user-defined function (<code>midMonths</code>) injected into the <code>plotLib</code> plotting library in the Angular controller used to manage the page:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">300</span><span class="ot"> aspect=</span><span class="st">3</span><span class="ot"> stroke-width=</span><span class="st">2</span><span class="kw">&gt;</span>
  <span class="kw">&lt;lines</span><span class="ot"> x=</span><span class="st">&quot;vic2012ooa.date&quot;</span><span class="ot"> y=</span><span class="st">&quot;vic2012ooa.tmp&quot;</span><span class="ot"> stroke=</span><span class="st">&quot;red&quot;</span><span class="kw">&gt;&lt;/lines&gt;</span>
  <span class="kw">&lt;lines</span><span class="ot"> x=</span><span class="st">&quot;[[midMonths(unique(vic2012ooa.date#getMonth()), 2012)]]&quot;</span>
<span class="ot">         y=</span><span class="st">&quot;[[meanBy(vic2012ooa.prc,vic2012ooa.date#getMonth())]]&quot;</span>
<span class="ot">         stroke=</span><span class="st">&quot;blue&quot;</span><span class="kw">&gt;&lt;/lines&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<h3 id="examples-2">Examples</h3>
<p>In this simple example, we use Angular data binding to set the <code>mu</code> and <code>sigma</code> attributes from scope variables called <code>mean</code> and <code>sdev</code>. These “attribute variables” are then in scope for the calculation of <code>x</code> and <code>y</code> attributes for the plot:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;lines</span><span class="ot"> mu=</span><span class="st">&quot;[[mean]]&quot;</span><span class="ot"> sigma=</span><span class="st">&quot;[[sdev]]&quot;</span>
<span class="ot">       x=</span><span class="st">&quot;[[seq(mu-3*sigma,mu+3*sigma,100)]]&quot;</span>
<span class="ot">       y=</span><span class="st">&quot;[[normal(x,mu,sigma)]]&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/lines&gt;</span></code></pre>
<p>The processing of this example goes as follows:</p>
<table>
<thead>
<tr class="header">
<th align="left">Evaluate</th>
<th align="left">   </th>
<th align="left">Requires</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>x</code></td>
<td align="left"></td>
<td align="left"><code>mu</code>, <code>sigma</code></td>
</tr>
<tr class="even">
<td align="left"><code>y</code></td>
<td align="left"></td>
<td align="left"><code>x</code>, <code>mu</code>, <code>sigma</code></td>
</tr>
<tr class="odd">
<td align="left"><code>mu</code></td>
<td align="left"></td>
<td align="left"><code>mean</code></td>
</tr>
<tr class="even">
<td align="left"><code>sigma</code></td>
<td align="left"></td>
<td align="left"><code>sdev</code></td>
</tr>
<tr class="odd">
<td align="left"><code>mean</code></td>
<td align="left"></td>
<td align="left">AngularJS scope variable</td>
</tr>
<tr class="even">
<td align="left"><code>sdev</code></td>
<td align="left"></td>
<td align="left">AngularJS scope variable</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="categorical-data">Categorical data</h2>
<p>For point and bar plots, it is possible to use categorical data values for the <code>x</code> and <code>y</code> data coordinates. A number of attributes are provided to support this, as well as a special data structure format to take advantage of hierarchical grouping using multiple categorical data fields.</p>
<p>For point plots, using a categorical value as the <code>x</code> attribute for a plot results in a discrete set of point clouds being produced, one per category, evenly spaced along the <code>x</code>-axis (see <a href="../Radian/gallery/#/68">this example</a>):</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">400</span><span class="ot"> aspect=</span><span class="st">1.5</span><span class="ot"> order-x=</span><span class="st">&quot;I. virginica;I. versicolor;I. setosa&quot;</span>
<span class="ot">      axis-x-label=</span><span class="st">&quot;Species&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Petal length&quot;</span>
<span class="ot">      marker=</span><span class="st">&quot;circle&quot;</span><span class="ot"> marker-size=</span><span class="st">10</span><span class="ot"> stroke=</span><span class="st">&quot;none&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;points</span><span class="ot"> x=</span><span class="st">&quot;[[iris.species]]&quot;</span>
<span class="ot">          jitter-x y=</span><span class="st">&quot;[[iris.petal_length]]&quot;</span>
<span class="ot">          fill=</span><span class="st">&quot;[[irispal(iris.species)]]&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/points&gt;</span>
<span class="kw">&lt;/plot&gt;</span>

<span class="kw">&lt;palette</span><span class="ot"> name=</span><span class="st">&quot;irispal&quot;</span><span class="ot"> type=</span><span class="st">&quot;discrete&quot;</span><span class="kw">&gt;</span>
  &quot;I. setosa&quot; red
  &quot;I. versicolor&quot; green
  &quot;I. virginica&quot; blue
<span class="kw">&lt;/palette&gt;</span>

<span class="kw">&lt;plot-data</span><span class="ot"> name=</span><span class="st">&quot;iris&quot;</span><span class="ot"> format=</span><span class="st">&quot;csv&quot;</span>
<span class="ot">           cols=</span><span class="st">&quot;sepal_length,sepal_width,petal_length,petal_width,species&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;species&quot;</span>
<span class="ot">            category-order=</span><span class="st">&quot;I. setosa;I. versicolor;I. virginica&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
5.1,3.5,1.4,0.2,I. setosa
4.9,3.0,1.4,0.2,I. setosa
4.7,3.2,1.3,0.2,I. setosa
4.6,3.1,1.5,0.2,I. setosa
...
<span class="kw">&lt;/plot-data&gt;</span></code></pre>
<p>For bar plots, categorical data fields can be used for the <code>x</code> attribute, as for point plots, but an aggregation scheme is also needed to turn the set of data values corresponding to the category into a single bar height to be plotted. For the <code>&lt;bars&gt;</code> directive, the <code>AGGREGATION</code> attribute (which can take on the values <code>mean</code>, <code>sum</code>, <code>min</code> or <code>max</code>) determines the aggregation scheme used. A simple example plots the mean value for each category:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> axis-x-label=</span><span class="st">&quot;off&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Rate&quot;</span><span class="ot"> stroke=</span><span class="st">&quot;none&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;bars</span><span class="ot"> x=</span><span class="st">&quot;[[d1#sex]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[d1#rate]]&quot;</span><span class="ot"> fill=</span><span class="st">&quot;[[mfpal(x)]]&quot;</span>
<span class="ot">        aggregation=</span><span class="st">&quot;mean&quot;</span><span class="ot"> bar-width=</span><span class="st">0.5</span><span class="kw">&gt;&lt;/bars&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<h3 id="supporting-attributes">Supporting attributes</h3>
<p>The following attributes are defined to support plots involving categorical data – some of these should appear on the <code>&lt;plot&gt;</code> directive, some on <code>&lt;metadata&gt;</code> and some on <code>&lt;bars&gt;</code> as specified in the following table:</p>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">   </th>
<th align="left">Directive</th>
<th align="left">   </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ORDER-X</code></td>
<td align="left"></td>
<td align="left"><code>&lt;plot&gt;</code></td>
<td align="left">Override default ordering for categorical data</td>
</tr>
<tr class="even">
<td align="left"><code>GROUP-X</code></td>
<td align="left"></td>
<td align="left"><code>&lt;plot&gt;</code></td>
<td align="left">Integer grouping level for hierarchical categorical data</td>
</tr>
<tr class="odd">
<td align="left"><code>JITTER-X</code></td>
<td align="left"></td>
<td align="left"><code>&lt;plot&gt;</code></td>
<td align="left">Jitter data points in <code>x</code>-direction (can specify a fraction of the distance between category values or take the default of 0.05)</td>
</tr>
<tr class="even">
<td align="left"><code>JITTER-Y</code></td>
<td align="left"></td>
<td align="left"><code>&lt;plot&gt;</code></td>
<td align="left">As for <code>JITTER-X</code> but in the <code>y</code>-direction</td>
</tr>
<tr class="odd">
<td align="left"><code>CATEGORY-ORDER</code></td>
<td align="left"></td>
<td align="left"><code>&lt;metadata&gt;</code></td>
<td align="left">Define default ordering for categorical data</td>
</tr>
<tr class="even">
<td align="left"><code>AGGREGATION</code></td>
<td align="left"></td>
<td align="left"><code>&lt;bars&gt;</code></td>
<td align="left">Aggregation scheme for generating bars from categorical data (one of <code>mean</code>, <code>sum</code>, <code>min</code>, <code>max</code>)</td>
</tr>
</tbody>
</table>
<p>Ordering of categorical values is controlled by the <code>CATEGORY-ORDER</code> attribute of the <code>&lt;metadata&gt;</code> directive and the <code>ORDER-X</code> attribute of the <code>&lt;plot&gt;</code> directive. In both cases, the ordering is defined by a semicolon-separated list of data values. The <code>&lt;plot&gt;</code> directive’s <code>ORDER-X</code> attribute overrides the default ordering defined by the <code>&lt;metadata&gt;</code> <code>CATEGORY-ORDER</code> attribute.</p>
<p>When displaying categorical data as points, it’s sometimes useful to jitter the position of individual points so as to avoid overlapping points (which give a false sense of the number of points in the plot). The <code>JITTER-X</code> and <code>JITTER-Y</code> attributes on the <code>&lt;plot&gt;</code> directive enable these small random displacements of individual points. These two attributes can either be given without any value, in which case points are jittered by a random value within ±5% of the separation between adjacent categorical values, or a jitter value can be given as a fraction of the inter-category spacing.</p>
<p>The <code>AGGREGATION</code> attribute is explained in the previous section.</p>
<p>Finally, the <code>GROUP-X</code> attribute is used to control the grouping of points and bars when hierarchical categorical data is used. To explain how this works, let’s look at three plots based on the following data:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot-data</span><span class="ot"> name=</span><span class="st">&quot;d1&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;sex&quot;</span><span class="ot"> category-order=</span><span class="st">&quot;male;female&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;env&quot;</span><span class="ot"> category-order=</span><span class="st">&quot;urban;rural&quot;</span><span class="kw">&gt;&lt;/metadata&gt;</span>
  <span class="kw">&lt;metadata</span><span class="ot"> name=</span><span class="st">&quot;age&quot;</span><span class="ot"> category-order=</span><span class="st">&quot;50-54;55-59;60-64;65-69;70-74&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/metadata&gt;</span>
  [ { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },
    { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;55-59&quot;, &quot;rate&quot;: 20.2 },
    { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;60-64&quot;, &quot;rate&quot;: 32.1 },
    { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;65-69&quot;, &quot;rate&quot;: 48.0 },
    { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;rural&quot;, &quot;age&quot;: &quot;70-74&quot;, &quot;rate&quot;: 65.5 },
    { &quot;sex&quot;: &quot;female&quot;, &quot;env&quot;: &quot;urban&quot;, &quot;age&quot;: &quot;50-54&quot;, &quot;rate&quot;: 15.5 },
    ... ]
<span class="kw">&lt;/plot-data&gt;</span></code></pre>
<p>We could make plots that split the data by a single category (<code>sex</code> or <code>env</code>, for instance), but we can also split on multiple categories at once by zipping the data for the relevant categories together:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">600</span><span class="ot"> aspect=</span><span class="st">1.5</span><span class="ot"> axis-x-label=</span><span class="st">&quot;off&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Rate&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;bars</span><span class="ot"> x=</span><span class="st">&quot;[[zip(d1#sex,d1#env)]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[d1#rate]]&quot;</span>
<span class="ot">        aggregation=</span><span class="st">&quot;mean&quot;</span><span class="ot"> bar-width=</span><span class="st">0.5</span><span class="ot"> stroke-width=</span><span class="st">10</span>
<span class="ot">        stroke=</span><span class="st">&quot;[[urpal(x#1)]]&quot;</span><span class="ot"> fill=</span><span class="st">&quot;[[mfpal(x#0)]]&quot;</span><span class="kw">&gt;&lt;/bars&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<p>In this case, there will be one bar for each distinct value of the pair <code>(sex, env)</code>, and the spacing between the bars will be constant. The bars are stroke and filled based on palettes where we pass the <code>env</code> value to <code>urpal</code> for the stroke and pass the <code>sex</code> value to <code>mfpal</code> for the fill. The bars appear in the order <code>(male,urban)</code>, <code>(male,rural)</code>, <code>(female,urban)</code>, <code>(female,rural)</code>, i.e. the first element in each zipped data item varies slowest.</p>
<p>Grouping behaviour is enabled by setting the <code>GROUP-X</code> attribute to the count of data levels that should be grouped together. Here, <code>GROUP-X</code> is set to one:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">600</span><span class="ot"> aspect=</span><span class="st">1.5</span><span class="ot"> axis-x-label=</span><span class="st">&quot;off&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Rate&quot;</span>
<span class="ot">      group-x=</span><span class="st">&quot;1&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;bars</span><span class="ot"> x=</span><span class="st">&quot;[[zip(d1#sex,d1#age)]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[d1#rate]]&quot;</span>
<span class="ot">        aggregation=</span><span class="st">&quot;mean&quot;</span><span class="ot"> bar-width=</span><span class="st">0.5</span><span class="ot"> stroke-width=</span><span class="st">2</span>
<span class="ot">        fill=</span><span class="st">&quot;[[mfpal(x#0)]]&quot;</span><span class="kw">&gt;&lt;/bars&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<p>This results in bars that are position in two groups, one for the each value of the <code>sex</code> field. Each group contains one bar for each value of the <code>age</code> field. The grouping can be switched around by changing the order of appearance of the zipped fields in the <code>x</code> data. This plot:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">600</span><span class="ot"> aspect=</span><span class="st">1.5</span><span class="ot"> axis-x-label=</span><span class="st">&quot;off&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Rate&quot;</span>
<span class="ot">      group-x=</span><span class="st">&quot;1&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;bars</span><span class="ot"> x=</span><span class="st">&quot;[[zip(d1#age,d1#sex)]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[d1#rate]]&quot;</span>
<span class="ot">        aggregation=</span><span class="st">&quot;mean&quot;</span><span class="ot"> bar-width=</span><span class="st">0.5</span><span class="ot"> stroke-width=</span><span class="st">2</span>
<span class="ot">        fill=</span><span class="st">&quot;[[mfpal(x#1)]]&quot;</span><span class="kw">&gt;&lt;/bars&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<p>has one group for each value of the <code>age</code> field, each group having a bar for the different values of the <code>sex</code> field.</p>
<p>This hierarchical composition of categorical data and grouping extends as you would expect for more than two variables (although this kind of plot generally looks better with two or, at most, three, levels of data).</p>
<h3 id="the-boxes-directive">The <code>boxes</code> directive</h3>
<p>The <code>boxes</code> directive provides rudimentary box-and-whisker plots. There will be more of this sort of thing in future releases of Radian. For the moment, you can write something like this:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;plot</span><span class="ot"> height=</span><span class="st">600</span><span class="ot"> aspect=</span><span class="st">1</span><span class="ot"> axis-x-label=</span><span class="st">&quot;Species&quot;</span><span class="ot"> axis-y-label=</span><span class="st">&quot;Petal length&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;boxes</span><span class="ot"> x=</span><span class="st">&quot;[[iris.species]]&quot;</span><span class="ot"> y=</span><span class="st">&quot;[[iris.petal_length]]&quot;</span>
<span class="ot">        stroke=</span><span class="st">&quot;[[irispal(iris.species)]]&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;/boxes&gt;</span>
<span class="kw">&lt;/plot&gt;</span></code></pre>
<p>and you will get box-and-whisker plots that show the minimum and maximum values for each category as the whiskers, the 25% and 75% percentiles as the bottom and top edges of the box and the median value as a line across the box. The usual paint styling attributes can be used.</p>

    <footer>
      <div>
         
        <span class="pull-right">Copyright © (2013) OpenBrain
        Ltd.  </span>
      </div>
    </footer>
  </div>
  <script src="../js/jquery.js"></script>
  <script src="../js/jquery.csv.js"></script>
  <script src="../js/escodegen.browser.js"></script>
  <script src="../js/estraverse.js"></script>
  <script src="../js/d3.v2.js"></script>
  <script src="../js/angular.min.js"></script>
  <script src="../js/radian.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/html5slider.js"></script>
  <script src="../js/hljs.js"></script>
  <script src="../js/app.js"></script>
  <script>
  </script>
</body>
</html>
